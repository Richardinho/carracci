/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(e,t){"use strict";typeof define=="function"&&define.amd?define("BaseType",[],function(){return t()}):typeof module=="object"&&module.exports?module.exports=t():e.BaseType=t()})(this,function(){"use strict";return{extend:function(e,t){var n=function(e){this.initialize&&typeof this.initialize=="function"&&this.initialize(e)},r=function(){};r.prototype=this.prototype,n.prototype=new r;for(var i in e)e.hasOwnProperty(i)&&(n.prototype[i]=e[i]);n.extend=this.extend;for(var s in t)t.hasOwnProperty(s)&&(n[s]=t[s]);return n.prototype.constructor=n,n}}}),define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!menu/template.html",[],function(){return'<section class="menu">\n  <ul class="menu__main-options">\n    <li>\n      create\n      <ul class="sublist">\n        <li data-command="create type">type box</li>\n        <li>\n          connector\n          <ul class="sublist2">\n            <li data-command="create connector horizontal">horizontal</li>\n            <li data-command="create connector vertical">vertical</li>\n          </ul>\n        </li>\n        <li data-command="create banner">banner</li>\n      </ul>\n    </li>\n    <li data-command="delete diagram">delete diagram</li>\n\n    <!--<li data-command="export">export</li> there are currently problems with exporting which I haven\'t figured out yet! -->\n    <li data-command="showjson">show json</li>\n  </ul>\n</section>\n'}),define("text!menu/initialTemplate.html",[],function(){return'<section class="menu">\n  <ul class="menu__main-options">\n    <li>\n      create\n      <ul class="sublist">\n        <li data-command="create diagram">diagram</li>\n      </ul>\n    </li>\n    <li>\n      load\n      <ul class="sublist">\n        <li data-command="load builderPattern">builder pattern</li>\n        <li data-command="load commandPattern">command pattern</li>\n        <li data-command="load decorator">decorator pattern</li>\n        <li data-command="load delegationPattern">delegation pattern</li>\n      </ul>\n    </li>\n  </ul>\n</section>\n'}),define("menu/view",["BaseType","text!menu/template.html","text!menu/initialTemplate.html"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.$el=e.el},initialTemplate:_.template(n),template:_.template(t),render:function(e){this.$el.html(this._getTemplate(e)),this.$el.show()},_getTemplate:function(e){return e?this.template():this.initialTemplate()}})}),function(){var e=this,t=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice,i;typeof exports!="undefined"?i=exports:i=e.Backbone={},i.VERSION="0.9.2";var s=e._;!s&&typeof require!="undefined"&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;i.setDomLibrary=function(e){o=e},i.noConflict=function(){return e.Backbone=t,this},i.emulateHTTP=!1,i.emulateJSON=!1;var u=/\s+/,a=i.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,n){var r,i,o,a,f,l;if(!(i=this._callbacks))return;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(u):s.keys(i);while(r=e.shift()){o=i[r],delete i[r];if(!o||!t&&!n)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||n&&l!==n)&&this.on(r,f,l)}return this},trigger:function(e){var t,r,i,s,o,a,f;if(!(i=this._callbacks))return this;a=i.all,e=e.split(u),f=n.call(arguments,1);while(t=e.shift()){if(r=i[t]){s=r.tail;while((r=r.next)!==s)r.callback.apply(r.context||this,f)}if(r=a){s=r.tail,o=[t].concat(f);while((r=r.next)!==s)r.callback.apply(r.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=i.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e));if(n=C(this,"defaults"))e=s.extend({},n,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)};s.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return s.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=s.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,o;s.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof f&&(r=r.attributes);if(n.unset)for(i in r)r[i]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var u=n.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(i in r){o=r[i];if(!s.isEqual(a[i],o)||n.unset&&s.has(a,i))delete l[i],(n.silent?this._silent:u)[i]=!0;n.unset?delete a[i]:a[i]=o,!s.isEqual(c[i],o)||s.has(a,i)!=s.has(c,i)?(this.changed[i]=o,n.silent||(this._pending[i]=!0)):(delete this.changed[i],delete this._pending[i])}return n.silent||this.change(n),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(s.clone(this.attributes),e)},fetch:function(e){e=e?s.clone(e):{};var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},save:function(e,t,n){var r,o;s.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n=n?s.clone(n):{};if(n.wait){if(!this._validate(r,n))return!1;o=s.clone(this.attributes)}var u=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?u:n))return!1;var a=this,f=n.success;n.success=function(e,t,i){var o=a.parse(e,i);n.wait&&(delete n.wait,o=s.extend(r||{},o));if(!a.set(o,n))return!1;f?f(a,e):a.trigger("sync",a,e,n)},n.error=i.wrapError(n.error,a,n);var l=this.isNew()?"create":"update",c=(this.sync||i.sync).call(this,l,this,n);return n.wait&&this.set(o,u),c},destroy:function(e){e=e?s.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(this.isNew())return r(),!1;e.success=function(i){e.wait&&r(),n?n(t,i):t.trigger("sync",t,i,e)},e.error=i.wrapError(e.error,t,e);var o=(this.sync||i.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=s.extend({},e.changes,this._silent);this._silent={};for(var n in r)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;while(!s.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var n in this.changed){if(this._pending[n]||this._silent[n])continue;delete this.changed[n]}this._previousAttributes=s.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?s.has(this.changed,e):!s.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(s.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=s.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var l=i.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};s.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var n,i,o,u,a,f,l={},c={},h=[];t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,o=e.length;n<o;n++){if(!(u=e[n]=this._prepareModel(e[n],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(n);continue}l[a]=c[f]=u}n=h.length;while(n--)e.splice(h[n],1);for(n=0,o=e.length;n<o;n++)(u=e[n]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=o,i=t.at!=null?t.at:this.models.length,r.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,o=this.models.length;n<o;n++){if(!l[(u=this.models[n]).cid])continue;t.index=n,u.trigger("add",u,this,t)}return this},remove:function(e,t){var n,r,i,o;t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){o=this.getByCid(e[n])||this.get(e[n]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return s.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=s.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return s.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,s.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?s.clone(e):{},e.parse===undefined&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t=t?s.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(i,s,o){t.wait&&n.add(i,t),r?r(i,s):i.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return s(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];s.each(c,function(e){l.prototype[e]=function(){return s[e].apply(s,[this.models].concat(s.toArray(arguments)))}});var h=i.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(h.prototype,a,{initialize:function(){},route:function(e,t,n){return i.history||(i.history=new m),s.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),i.history.route(e,s.bind(function(r){var s=this._extractParameters(e,r);n&&n.apply(this,s),this.trigger.apply(this,["route:"+t].concat(s)),i.history.trigger("route",this,t,s)},this)),this},navigate:function(e,t){i.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=i.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,s.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=s.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),n=document.documentMode,r=y.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);r&&(this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=window.location,u=i.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&i.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,i.protocol+"//"+i.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=s.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=i.View=function(e){this.cid=s.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];s.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var r=document.createElement(e);return t&&o(r).attr(t),n&&o(r).html(n),r},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o?e:o(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];s.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(w),i=r[1],o=r[2];n=s.bind(n,this),i+=".delegateEvents"+this.cid,o===""?this.$el.bind(i,n):this.$el.delegate(o,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=s.extend({},this.options,e));for(var t=0,n=E.length;t<n;t++){var r=E[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};i.sync=function(e,t,n){var r=x[e];n||(n={});var u={type:r,dataType:"json"};return n.url||(u.url=C(t,"url")||k()),!n.data&&t&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),i.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),i.emulateHTTP&&(r==="PUT"||r==="DELETE")&&(i.emulateJSON&&(u.data._method=r),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),u.type!=="GET"&&!i.emulateJSON&&(u.processData=!1),o.ajax(s.extend(u,n))},i.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,n){var r;return t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){e.apply(this,arguments)},s.extend(r,e),T.prototype=e.prototype,r.prototype=new T,t&&s.extend(r.prototype,t),n&&s.extend(r,n),r.prototype.constructor=r,r.__super__=e.prototype,r},C=function(e,t){return!e||!e[t]?null:s.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')}}.call(this),define("backbone",["jquery","underscore"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),define("events/eventsBus",["backbone"],function(e){var t={};return _.extend(t,e.Events),{on:function(){t.on.apply(t,arguments)},off:function(){t.off.apply(t,arguments)},trigger:function(){t.trigger.apply(t,arguments)}}}),define("menu/controller",["BaseType","menu/view","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.diagramController=e.diagramController,this.view=new t({el:$("#menu")}),this.view.render(this.componentModel.diagram),this.view.$el.on("click","[data-command]",$.proxy(this.handleClick,this)),this.view.render(this.componentModel.diagram)},componentModel:{left:0,top:0,diagram:!1},handleClick:function(e){var t=$(e.currentTarget).data("command"),n=t.split(/\s/);this.diagramController.command({command:n.shift(),args:n}),this.view.render(this.componentModel.diagram)},createDiagram:function(e){this.diagramController.command({command:"load",args:[e]}),this.view.render(this.componentModel.diagram)}})}),define("text!diagram/types/template.html",[],function(){return'<div data-role="typeEditor-panel" class="typeEditor__panel">\n  <div class="typeEditor__header">\n    <h2 class="typeEditor--header">type:</h2>\n  </div>\n  <label>\n    Name:\n    <input\n      data-role="typeName"\n      name="name"\n      value="<%= name %>"\n      class="text-input"\n      type="text"\n    />\n  </label>\n\n  <label>\n    Flavor:\n    <input\n      data-role="flavor"\n      list="flavor"\n      name="flavor"\n      value="<%= flavor %>"\n      class="text-input"\n      type="text"\n    />\n  </label>\n\n  <div class="typeEditor__property-header">\n    <h2>Properties</h2>\n    <button data-role="add-prop" class="typeEditor__add">add Property</button>\n  </div>\n  <table data-role="property-table" class="typeEditor_table">\n    <thead>\n      <tr>\n        <th>vis</th>\n        <th>name</th>\n        <th>type</th>\n        <th></th>\n      </tr>\n    </thead>\n    <tbody>\n      <% _.each(properties, function(property) { %>\n\n      <tr>\n        <td>\n          <input\n            name="visibility"\n            list="visibility"\n            type="text"\n            value="<%= property.visibility %>"\n          />\n        </td>\n        <td><input name="name" type="text" value="<%= property.name %>" /></td>\n        <td><input name="type" type="text" value="<%= property.type %>" /></td>\n        <td><input data-role="deleteprop" type="button" value="del" /></td>\n      </tr>\n\n      <% }) %>\n    </tbody>\n  </table>\n  <div class="typeEditor__property-header">\n    <h2>Methods</h2>\n    <button data-role="add-method" class="typeEditor__add">add Method</button>\n  </div>\n  <table data-role="method-table" class="typeEditor_table">\n    <thead>\n      <tr>\n        <th>vis</th>\n        <th>name</th>\n        <th>args</th>\n        <th>returnType</th>\n      </tr>\n    </thead>\n    <tbody>\n      <% _.each(methods, function(method) { var args = _.reduce(method.args,\n      function(memo, arg, key) { return memo + "," + (arg.name + ":" +\n      arg.type); }, ""); args = args.substring(1); %>\n\n      <tr>\n        <td>\n          <input\n            name="visibility"\n            list="visibility"\n            type="text"\n            value="<%= method.visibility %>"\n          />\n        </td>\n        <td><input name="name" type="text" value="<%= method.name %>" /></td>\n        <td>\n          <input data-role="methodArgs" value="<%= args %>" type="text" />\n        </td>\n        <td>\n          <input\n            name="returnType"\n            type="text"\n            value="<%= method.returnType %>"\n          />\n        </td>\n        <td><input data-role="deletemethod" type="button" value="del" /></td>\n      </tr>\n\n      <% }) %>\n    </tbody>\n  </table>\n\n  <datalist id="visibility">\n    <option value="private"></option>\n    <option value="protected"></option>\n    <option value="public"></option>\n  </datalist>\n\n  <datalist id="flavor">\n    <option value="abstract"></option>\n    <option value="interface"></option>\n    <option value="class"></option>\n  </datalist>\n\n  <div class="buttons">\n    <button class="button--save" data-role="save">save</button>\n    <button class="button--cancel" data-role="cancel">cancel</button>\n    <button class="button--note" data-role="add-note">add note</button>\n    <button data-role="delete" class="typeEditor__delete">delete</button>\n  </div>\n</div>\n'}),define("text!diagram/types/rowTemplate.html",[],function(){return'<tr>\n  <td><input name="visibility" list="visibility" type="text" /></td>\n  <td><input name="name" type="text" /></td>\n  <td><input name="type" type="text" /></td>\n  <td><input data-role="deleteprop" type="button" value="del" /></td>\n</tr>\n'}),define("text!diagram/types/methodRowTemplate.html",[],function(){return'<tr>\n  <td><input list="visibility" name="visibility" type="text" /></td>\n  <td><input name="name" type="text" /></td>\n  <td><input data-role="methodArgs" type="text" /></td>\n  <td><input name="returnType" type="text" /></td>\n  <td><input data-role="deletemethod" type="button" value="del" /></td>\n</tr>\n'}),define("diagram/types/editorView",["BaseType","text!diagram/types/template.html","text!diagram/types/rowTemplate.html","text!diagram/types/methodRowTemplate.html"],function(e,t,n,r){"use strict";return e.extend({initialize:function(e){this.$el=e.el,this.$el.hide()},getArgsEl:function(){return this.$el.find("[data-role=argsContainer]")},rowTemplate:_.template(n),methodRowTemplate:_.template(r),addRowToPropertyTable:function(){$("[data-role=property-table] tbody",this.$el).append(this.rowTemplate())},addRowToMethodTable:function(){$("[data-role=method-table] tbody",this.$el).append(this.methodRowTemplate())},template:_.template(t),hide:function(){this.$el.css({display:"none"})},render:function(e){this.$el.html(this.template(this.model.model)),this.$el.css({display:"flex",zIndex:e})}})}),define("diagram/types/editor",["BaseType","diagram/types/editorView","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.manager=e.manager,this.diagramController=e.diagramController,this.view=new t({el:$("#type-editor")}),this.view.$el.on("click","[data-role=save]",$.proxy(this.save,this)),this.view.$el.on("click","[data-role=cancel]",$.proxy(this.close,this)),this.view.$el.on("click","[data-role=add-prop]",$.proxy(this.addProp,this)),this.view.$el.on("click","[data-role=add-method]",$.proxy(this.addMethod,this)),this.view.$el.on("click","[data-role=deleteprop]",$.proxy(this.deleteProp,this)),this.view.$el.on("click","[data-role=deletemethod]",$.proxy(this.deleteMethod,this)),this.view.$el.on("click","[data-role=methodArgs]",$.proxy(this.argsClick,this)),this.view.$el.on("click","[data-role=add-note]",$.proxy(this.addNote,this)),this.view.$el.on("click","[data-role=delete]",$.proxy(this.del,this))},show:function(e,t){this.model=t,this.view.model=this.model,this.view.render(e)},close:function(){this.manager.onCloseWidget(),this.view.hide()},del:function(){this.deleteNotes(),this.diagramController.deleteType(this.model.model.id),this.model.trigger("destroy"),this.close()},deleteNotes:function(){var e=this.model.model.notes;e.forEach(function(e){n.trigger("destroy:"+e)})},addProp:function(){this.view.addRowToPropertyTable()},addNote:function(){var e=this.diagramController.createNote(this.model);this.model.model.notes.push(e),this.close()},addMethod:function(){this.view.addRowToMethodTable()},deleteProp:function(e){$(e.currentTarget).closest("tr").remove()},deleteMethod:function(e){$(e.currentTarget).closest("tr").remove()},argsClick:function(e){this.manager.showArgsEditor(e.target,this)},save:function(){var e=this,t=$("input[data-role=typeName]",this.view.$el).val(),n=$("input[data-role=flavor]",this.view.$el).val();e.model.model.name=t,e.model.model.flavor=n,e.model.model.properties={},e.model.model.methods={},$("[data-role=property-table] tbody tr",this.view.$el).each(function(t,n){if(e._validateRow(n)){var r=$("input[name=name]",n).val();e.model.model.properties[r]={},$("input[type=text]",n).each(function(t,n){e.model.model.properties[r][n.name]=n.value})}}),$("[data-role=method-table] tbody tr",this.view.$el).each(function(t,n){if(e._validateRow(n)){var r=$("input[name=name]",n).val();e.model.model.methods[r]={},$("input[type=text]",n).each(function(t,n){if(n.dataset.role==="methodArgs"){var i=n.value.split(/,/);if(i[0].length>0){var s=_.reduce(i,function(e,t){var n=t.split(/:/);return n&&(e[n[0]]={name:n[0],type:n[1]}),e},{});console.log("editor",s),e.model.model.methods[r].args=s}}else e.model.model.methods[r][n.name]=n.value})}}),this.model.trigger("update"),this.close()},_validateRow:function(e){var t=e.querySelectorAll("[type=text]:not([data-role=methodArgs])");return Array.prototype.every.call(t,function(e){return!!e.value})}})}),define("text!diagram/types/argsTemplate.html",[],function(){return'<div class="my__container">\n  <h2 class="argsEditor__header">Args</h2>\n  <button\n    data-role="addArgRow"\n    title="add a new row"\n    class="argsEditor__button--add"\n  >\n    add argument\n  </button>\n  <table class="argsEditor__table">\n    <thead>\n      <tr>\n        <th>name</th>\n        <th>type</th>\n      </tr>\n    </thead>\n    <tbody>\n      <% _.each(args, function(arg) { %>\n\n      <tr>\n        <td><input value="<%= arg.name %>" type="text" /></td>\n        <td><input value="<%= arg.type %>" type="text" /></td>\n        <td>\n          <input\n            data-role="deleteArg"\n            value="del"\n            title="delete this row"\n            tabindex="-1"\n            type="button"\n          />\n        </td>\n      </tr>\n\n      <% }) %>\n    </tbody>\n  </table>\n  <button data-role="save" title="save edit" class="args-editor__button--save">\n    save\n  </button>\n  <button\n    data-role="cancel"\n    title="cancel edit"\n    class="args-editor__button--cancel"\n  >\n    cancel\n  </button>\n</div>\n'}),define("text!diagram/types/argsRowTemplate.html",[],function(){return'<tr>\n  <td><input value="" type="text" /></td>\n  <td><input value="" type="text" /></td>\n  <td>\n    <input\n      data-role="deleteArg"\n      value="del"\n      title="delete this row"\n      tabindex="-1"\n      type="button"\n    />\n  </td>\n</tr>\n'}),define("diagram/types/argsEditorView",["BaseType","text!diagram/types/argsTemplate.html","text!diagram/types/argsRowTemplate.html"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.$el=e.el,this.$el.hide()},template:_.template(t),show:function(e,t,n,r){this.$el.html(this.template({args:t})),this.$el.css({zIndex:e}),this.$el.css({left:n,top:r}),this.$el.show()},getRows:function(){return this.$el.find("tbody tr")},rowTemplate:_.template(n),hide:function(){this.$el.hide()},addRowToTable:function(){$("tbody",this.$el).append(this.rowTemplate())}})}),define("diagram/types/argsController",["BaseType","diagram/types/argsEditorView"],function(e,t){"use strict";return e.extend({initialize:function(e){this.manager=e.manager,this.view=new t({el:e.el}),this.view.$el.on("click","[data-role=cancel]",$.proxy(this.close,this)),this.view.$el.on("click","[data-role=addArgRow]",$.proxy(this.addRow,this)),this.view.$el.on("click","[data-role=deleteArg]",$.proxy(this.deleteArg,this)),this.view.$el.on("click","[data-role=save]",$.proxy(this.save,this))},show:function(e,t){var n=$(t).position().left,r=$(t).position().top;this.argInput=$(t);var i=this.argInput.val(),s;if(i){var o=i.split(/,/);s=_.reduce(o,function(e,t){var n=t.split(/:/);return e.push({name:n[0],type:n[1]}),e},[])}else s=[{name:"",type:""}];this.view.show(e,s,n,r)},save:function(){var e=this.view.getRows(),t="";e.each(function(e,n){var r=$("input[type=text]",n);t+=","+r[0].value+":"+r[1].value}),this.argInput.val(t.substring(1)),this.close()},close:function(){this.manager.onCloseWidget(),this.view.hide()},deleteArg:function(e){$(e.currentTarget).closest("tr").remove()},addRow:function(){this.view.addRowToTable()}})}),define("text!modalEditor/template.html",[],function(){return'<div class="modalEditor">\n  <div data-role="editor-panel" class="modalEditor__panel">\n    edit this text and click save to update note\n\n    <textarea data-role="contents" rows="10" class="modalEditor__textarea">\n<%=  contents %></textarea\n    >\n    <label\n      >width:<input\n        class="modalEditor__width"\n        data-role="width"\n        type="text"\n        value=""\n    /></label>\n    <button data-role="save">save</button>\n    <button data-role="cancel">cancel</button>\n    <button data-role="delete" class="modalEditor__delete">delete</button>\n  </div>\n</div>\n'}),define("modalEditor/view",["BaseType","underscore","text!modalEditor/template.html"],function(e,t,n){return e.extend({initialize:function(e){this.$el=e.el,this.hide()},componentModel:{xOffset:10,yOffset:10,left:0,top:0},template:t.template(n),reset:function(e){this.model=e;var t=this.model.getXCood(),n=this.model.getYCood(),r=this.model.getWidth(),i=this.model.getHeight();this.componentModel.left=t+r+this.componentModel.xOffset,this.componentModel.top=n+this.componentModel.yOffset},render:function(e){this.$el.html(this.template({contents:this.model.getText()}));var t=this.model.getXCood(),n=this.model.getYCood();this._position(t,n),this.$el.css({zIndex:e}),this.$el.show()},hide:function(){this.$el.hide()},getTextAreaContents:function(){return this.$el.find("[data-role=contents]").val()},getWidthContents:function(){return this.$el.find("[data-role=width]").val()},_position:function(e,t){$("[data-role=editor-panel]",this.$el).css({left:e+50,top:t+50})}})}),define("modalEditor/controller",["BaseType","underscore","modalEditor/view"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.manager=e.manager,this.diagramController=e.diagramController,this.view=new n({el:$("#modalEditor")}),this.view.$el.on("click","[data-role=cancel]",$.proxy(this.close,this)),this.view.$el.on("click","[data-role=save]",$.proxy(this.save,this)),this.view.$el.on("click","[data-role=delete]",$.proxy(this.del,this))},show:function(e,t){this.model=t,this.view.model=this.model,this.view.render(e)},close:function(){this.manager.onCloseWidget(),this.view.hide()},del:function(){this.diagramController.deleteNote(this.model.id),this.model.trigger("destroy"),this.close()},save:function(){var e=this._getContents(),t=this._getWidth();this.model.save(e,t),this.close()},_getWidth:function(){return this.view.getWidthContents()},_getContents:function(){return this.view.getTextAreaContents()}})}),define("text!diagram/connectors/template.html",[],function(){return'<div class="connector-editor__panel">\n    <h2>Do you want to delete this connector?</h2>\n\n    <button data-role="cancel">cancel</button>\n    <button data-role="delete" class="">delete</button>\n</div>\n'}),define("diagram/connectors/editorView",["BaseType","text!diagram/connectors/template.html"],function(e,t){"use strict";return e.extend({initialize:function(e){this.$el=e.el,this.$el.hide()},hide:function(){this.$el.css({display:"none"})},template:_.template(t),render:function(e){this.$el.html(this.template()),this.$el.css({display:"block",zIndex:e})}})}),define("diagram/connectors/editorController",["BaseType","diagram/connectors/editorView"],function(e,t){"use strict";return e.extend({initialize:function(e){this.manager=e.manager,this.diagramController=e.diagramController,this.view=new t({el:$("#connector-editor")}),this.view.$el.on("click","[data-role=cancel]",$.proxy(this.close,this)),this.view.$el.on("click","[data-role=delete]",$.proxy(this.del,this))},show:function(e,t){this.model=t,this.view.model=this.model,this.view.render(e)},close:function(){this.manager.onCloseWidget(),this.view.hide()},del:function(){this.diagramController.deleteConnector(this.model.model.id),this.model.trigger("destroy"),this.close()}})}),define("text!diagram/banner/editorTemplate.html",[],function(){return'\n<div data-role="bannerEditor-panel" class="bannerEditor__panel">\n    <h2 class="bannerEditor--header">Input banner details below:</h2>\n    <label class="label">\n        <span class="label--caption">banner title</span>\n        <input name="title" value="<%= title %>" class="bannerEditor__text-input" type="text"/>\n    </label>\n\n    <label class="label">\n        <span class="label--caption">author</span>\n        <input name="author" value="<%= author %>" class="bannerEditor__text-input" type="text"/>\n    </label>\n\n    <label class="label">\n        <span class="label--caption">creation date</span>\n        <input name="created" value="<%= created %>" class="bannerEditor__text-input" type="text"/>\n    </label>\n\n    <label class="label--text-area">\n        <span>banner contents</span>\n        <textarea name="description" data-role="contents" rows="10" class="bannerEditor__textarea"><%= description %></textarea>\n    </label>\n    <button data-role="save">save</button>\n    <button data-role="cancel">cancel</button>\n    <button data-role="delete" class="bannerEditor__delete">delete</button>\n</div>\n'}),define("diagram/banner/editorView",["BaseType","text!diagram/banner/editorTemplate.html"],function(e,t){"use strict";return e.extend({initialize:function(e){this.$el=e.el,this.$el.hide()},template:_.template(t),show:function(e,t){this.$el.html(this.template(t.model)),this.$el.css({zIndex:e}),this.$el.show()},hide:function(){this.$el.hide()}})}),define("diagram/banner/editor",["BaseType","diagram/banner/editorView"],function(e,t){"use strict";return e.extend({initialize:function(e){this.view=new t({el:$("#banner-editor")}),this.manager=e.manager,this.view.$el.on("click","[data-role=save]",$.proxy(this.save,this)),this.view.$el.on("click","[data-role=cancel]",$.proxy(this.close,this))},save:function(){$("input, textarea",this.view.$el).each($.proxy(function(e,t){this.model.model[t.name]=t.value},this)),this.model.trigger("change"),this.close()},show:function(e,t){this.model=t,this.view.show(e,t)},close:function(){this.manager.onCloseWidget(),this.view.hide()}})}),define("text!diagram/json/jsonViewerTemplate.html",[],function(){return'\n\n<div class="jsonViewer__panel">\n    <button data-role="close">close</button>\n    <div class="jsonViewer__panel--interior">\n        <pre><%= JSON.stringify(diagram, null, 4) %></pre>\n    </div>\n    <button data-role="close">close</button>\n</div>\n'}),define("diagram/json/jsonViewerView",["BaseType","text!diagram/json/jsonViewerTemplate.html"],function(e,t){"use strict";return e.extend({initialize:function(){this.$el=$("#json-viewer")},template:_.template(t),show:function(e,t){this.$el.html(this.template({diagram:t})),this.$el.css({zIndex:e}),this.$el.show()},hide:function(){this.$el.hide()}})}),define("diagram/json/jsonViewerController",["BaseType","diagram/json/jsonViewerView"],function(e,t){"use strict";return e.extend({initialize:function(e){this.view=new t({}),this.manager=e.manager,this.view.$el.on("click","[data-role=close]",$.proxy(this.close,this))},show:function(e,t){this.model=t,this.view.show(e,t)},close:function(){this.manager.onCloseWidget(),this.view.hide()}})}),define("diagram/widgetManager",["BaseType","diagram/types/editor","diagram/types/argsController","modalEditor/controller","diagram/connectors/editorController","diagram/banner/editor","diagram/json/jsonViewerController"],function(e,t,n,r,i,s,o){"use strict";return e.extend({initialize:function(e){this.stackingOrderIndex=0,this.typeEditor=new t({manager:this,diagramController:e.diagramController}),this.argsController=new n({el:$("#args-editor"),manager:this}),this.notesController=new r({manager:this,diagramController:e.diagramController}),this.connectorEditorController=new i({manager:this,diagramController:e.diagramController}),this.bannerEditorController=new s({manager:this,diagramController:e.diagramController}),this.jsonViewerController=new o({manager:this}),this.$overlay=$("#overlay"),this.$overlay.hide()},getOverlayIndex:function(){return this.stackingOrderIndex},getWidgetIndex:function(){return this.stackingOrderIndex*2},showJson:function(e){this.stackingOrderIndex++,this._showOverlay(),this.jsonViewerController.show(this.getWidgetIndex(),e)},showTypeEditor:function(e){this.stackingOrderIndex++,this._showOverlay(),this.typeEditor.show(this.getWidgetIndex(),e)},showArgsEditor:function(e,t){this.stackingOrderIndex++,this._showOverlay(),this.argsController.show(this.getWidgetIndex(),e,t)},showConnectorEditor:function(e){this.stackingOrderIndex++,this._showOverlay(),this.connectorEditorController.show(this.getWidgetIndex(),e)},showBannerEditor:function(e){this.stackingOrderIndex++,this._showOverlay(),this.bannerEditorController.show(this.getWidgetIndex(),e)},onCloseWidget:function(){this.stackingOrderIndex--,this._showOverlay()},showNoteEditor:function(e){this.stackingOrderIndex++,this._showOverlay(),this.notesController.show(this.getWidgetIndex(),e)},_showOverlay:function(){this.getOverlayIndex()?(this.$overlay.show(),this.$overlay.css({zIndex:this.getOverlayIndex()})):this.$overlay.hide()}})}),define("diagram/diagramController",["BaseType","canvg","jquery","menu/controller","diagram/widgetManager","events/eventsBus"],function(e,t,n,r,i,s){"use strict";return e.extend({initialize:function(e){this.diagramModel=e.diagramModel,this.componentFactory=e.componentFactory,this.mainMenu=new r({diagramController:this}),this.widgetManager=new i({diagramController:this}),s.on("dblclick:type",this.showTypeEditor,this),s.on("dblclick:note",this.showNoteEditor,this),s.on("dblclick:connector",this.showConnectorEditor,this),s.on("dblclick:banner",this.showBannerEditor,this)},showTypeEditor:function(e){this.widgetManager.showTypeEditor(e)},setDiagram:function(e){this.mainMenu.createDiagram(e)},showNoteEditor:function(e){this.widgetManager.showNoteEditor(e)},showConnectorEditor:function(e){this.widgetManager.showConnectorEditor(e)},showBannerEditor:function(e){this.widgetManager.showBannerEditor(e)},command:function(e){var t=e.command,n=e.args;t==="create"&&n[0]==="type"&&this.componentFactory.createType();if(t==="create"&&n[0]==="diagram"){var r=window.prompt("what is the name of your diagram?");this.componentFactory.createDiagram(null,r),this.mainMenu.componentModel.diagram=!0}if(t==="create"&&n[0]==="banner"){var i=this.componentFactory.createBanner();this.widgetManager.showBannerEditor(i)}t==="create"&&n[0]==="connector"&&(n[1]==="horizontal"?this.componentFactory.createHorizontalConnector():this.componentFactory.createVerticalConnector()),t==="showjson"&&this.widgetManager.showJson(this.diagramModel.currentDiagram),t==="delete"&&n[0]==="diagram"&&(this.mainMenu.componentModel.diagram=!1,s.trigger("destroy"),delete this.diagramModel.currentDiagram),t==="load"&&(this.mainMenu.componentModel.diagram=!0,this.load(n[0])),t==="export"&&this.export()},createNote:function(e){return this.componentFactory.createNote(e)},deleteNote:function(e){this.diagramModel.deleteNote(e)},deleteType:function(e){this.diagramModel.deleteTypeAndConnectors(e)},deleteConnector:function(e){this.diagramModel.deleteConnector(e)},"export":function(){var e="png";switch(e){case"jpeg":console.log("jpeg not yet supported");break;case"png":var r=document.createElement("canvas");r.width=1e3,r.height=800;var i=n("<div>").append(n("svg").clone()).html();t(r,i);var s=r.toDataURL();window.open(s,"mywindow");break;default:return Promise.reject(e+" is not supported")}return Promise.resolve("exported to "+e)},show:function(){return"<pre>"+this.diagramModel.toJSON()+"</pre>"},bannerExists:function(){return this.diagramModel.bannerExists()},load:function(e){var t=Promise.resolve(n.ajax({url:"diagrams/"+e+".json",dataType:"json"}));t.then(n.proxy(function(e){this.componentFactory.createDiagram(e)},this)).catch(function(e){console.log(e)})}})}),define("diagram/boxNodeMediator",["BaseType"],function(e){return e.extend({initialize:function(e){this.nodeMediator=e.nodeMediator,this.typeController=e.typeController,this.nodeOrientation=e.nodeOrientation,e.dontMove||this._moveNodeOnToBox(),this.typeController.addAttachedNodeMediator(this),this.nodeMediator.addBoxNodeMediator(this,this.nodeOrientation),this.typeController.model.on("changeHeight",this.repositionNode,this),this.typeController.model.on("changeWidth",this.repositionNode,this)},destroy:function(){this.typeController.unAttachNodeMediator(this)},destroyConnector:function(){this.nodeMediator.destroyConnector()},moveNode:function(e,t){this.nodeMediator.updateUsingDifference(this.nodeOrientation,e,t)},repositionNode:function(){this._moveNodeOnToBox()},destroyFromType:function(){this.nodeMediator.removeBoxNodeMediator(this.nodeOrientation)}})}),define("diagram/boxHorizontalNodeMediator",["diagram/boxNodeMediator"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},getBoxRightLimit:function(){return this.typeController.getRightXLimit()},getBoxLeftLimit:function(){return this.typeController.getLeftXLimit()},calculateNodeXCood:function(e){return e>this.getBoxRightLimit()?this.getBoxRightLimit():this.getBoxLeftLimit()},getDistalNodeCoods:function(e,t,n,r){var i=this.typeController.getTopYLimit(),s=this.typeController.getBottomYLimit();if(t<i||t>s)t=r;return{x:e,y:t}},getProximalNodeCoods:function(e,t,n,r){var i=this.typeController.getTopYLimit(),s=this.typeController.getBottomYLimit();if(t<i||t>s)t=r;return{x:e,y:t}},getRightNodeCoods:function(e,t,n,r){return this._getNodeCoods(e,t,n,r)},getLeftNodeCoods:function(e,t,n,r){return this._getNodeCoods(e,t,n,r)},_getNodeCoods:function(e,t,n,r){var i=this.typeController.getTopYLimit(),s=this.typeController.getBottomYLimit();if(t<i||t>s)t=r;return{x:n,y:t}},_moveNodeOnToBox:function(){var e=this.nodeMediator.proximalNodeModel.getXCood(),t=this.calculateNodeXCood(e),n=this.typeController.getTopYLimit(),r=this.typeController.getBottomYLimit(),i=(n+r)/2;this.nodeMediator.update(this.nodeOrientation,t,i,!0)}})}),define("diagram/boxVerticalNodeMediator",["diagram/boxNodeMediator"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},getBoxTopLimit:function(){return this.typeController.getTopYLimit()},getBoxBottomLimit:function(){return this.typeController.getBottomYLimit()},getSecondBottomNodeCoods:function(e,t,n){var r=this.typeController.getLeftXLimit(),i=this.typeController.getRightXLimit();if(e<r||e>i)e=n;return{x:e,y:t}},calculateNodeYCood:function(e){return e<this.getBoxTopLimit()?this.getBoxTopLimit():this.getBoxBottomLimit()},getSecondTopNodeCoods:function(e,t,n){var r=this.typeController.getLeftXLimit(),i=this.typeController.getRightXLimit();if(e<r||e>i)e=n;return{x:e,y:t}},getBottomNodeCoods:function(e,t,n,r){var i=this.typeController.getRightXLimit(),s=this.typeController.getLeftXLimit();if(e<s||e>i)e=n;return{x:e,y:r}},getTopNodeCoods:function(e,t,n,r){var i=this.typeController.getRightXLimit(),s=this.typeController.getLeftXLimit();if(e<s||e>i)e=n;return{x:e,y:r}},_getNodeCoods:function(e,t,n,r){},_moveNodeOnToBox:function(){var e=this.nodeMediator.secondTopNodeModel.getYCood(),t=this.calculateNodeYCood(e),n=this.typeController.getRightXLimit(),r=this.typeController.getLeftXLimit(),i=(n+r)/2;this.nodeMediator.update(this.nodeOrientation,i,t,!0)}})}),define("utility/idGenerator",[],function(){return{nextId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}}),define("diagram/connectors/verticalConnectorBasicJson",[],function(){return function(){return{orientation:"vertical",nodes:{top:{xCood:300,yCood:100,attached:!1,attachedBox:"",arrow:{style:"blackConnectArrow",direction:"top"}},secondTop:{xCood:300,yCood:200,attached:!1,attachedBox:""},secondBottom:{xCood:400,yCood:200,attached:!1,attachedBox:""},bottom:{xCood:400,yCood:300,attached:!1,attachedBox:"",arrow:{style:"whiteArrow",direction:"bottom"}}},lineStyle:"solid"}}}),define("diagram/connectors/horizontalConnectorBasicJson",[],function(){return function(){"use strict";return{orientation:"horizontal",nodes:{left:{xCood:100,yCood:100,attached:!1,attachedBox:"",arrow:{style:"blackConnectArrow",direction:"left"}},proximal:{xCood:200,yCood:100,attached:!1,attachedBox:""},distal:{xCood:200,yCood:300,attached:!1,attachedBox:""},right:{xCood:400,yCood:300,attached:!1,attachedBox:"",arrow:{style:"whiteArrow",direction:"right"}}},lineStyle:"solid"}}}),define("diagram/types/typeJSON",[],function(){return function(e){return{name:"default name",id:e,properties:{testProp:{name:"testProp",visibility:"private",type:"String"}},flavor:"interface",methods:{doIt:{name:"doIt",visibility:"public",returnType:"void",args:[{name:"foo",type:"String"},{name:"bar",type:"Integer"}]},undoit:{name:"undoit",visibility:"public",returnType:"void",args:[{name:"hello",type:"Integer"}]}},xCood:700,yCood:400,width:10,height:10,notes:[]}}}),define("diagram/banner/bannerJSON",[],function(){"use strict";return function(){return{title:"default",description:"default",author:"default",width:300,fontSize:"12",created:"default",fontFamily:"arial",paddingHorizontal:12,xCood:"0",yCood:"0"}}}),define("diagram/diagramModel",["BaseType","diagram/boxHorizontalNodeMediator","diagram/boxVerticalNodeMediator","utility/idGenerator","events/eventsBus","diagram/connectors/verticalConnectorBasicJson","diagram/connectors/horizontalConnectorBasicJson","diagram/types/typeJSON","diagram/banner/bannerJSON"],function(e,t,n,r,i,s,o,u,a){"use strict";return e.extend({initialize:function(){this.currentDiagram=null,i.on("attachRequest",function(e,t){this.requestedNode={nodeMediator:e,nodeOrientation:t}}),i.on("receiveRequest",function(e){if(this.requestedNode){var r=this.requestedNode.nodeOrientation;r==="left"||r==="right"?new t({nodeMediator:this.requestedNode.nodeMediator,nodeOrientation:this.requestedNode.nodeOrientation,typeController:e}):new n({nodeMediator:this.requestedNode.nodeMediator,nodeOrientation:this.requestedNode.nodeOrientation,typeController:e}),this.requestedNode=null}})},createVerticalConnector:function(){var e=r.nextId(),t=s();return t.id=e,this.currentDiagram.connectors[e]=t,this.currentDiagram.connectors[e]},createHorizontalConnector:function(){var e=r.nextId(),t=o();return t.id=e,this.currentDiagram.connectors[e]=t,this.currentDiagram.connectors[e]},deleteType:function(e){delete this.currentDiagram.types[e]},deleteTypeAndConnectors:function(e){delete this.currentDiagram.types[e];var t=this.currentDiagram.connectors,n=[];for(var r in t){var i=t[r],s=i.nodes;for(var r in s){var o=s[r];e===o.attachedBox&&n.push(i.id)}}n.forEach(function(e){delete this.currentDiagram.connectors[e]}.bind(this))},createBanner:function(){return this.currentDiagram.banner=a(),this.currentDiagram.banner},createNote:function(e){var t=r.nextId();return this.currentDiagram.notes[t]={id:t,typeId:e,text:"",fontSize:"12",width:300,fontFamily:"arial",paddingHorizontal:12,xCood:"0",yCood:"0"},this.currentDiagram.notes[t]},deleteNote:function(e){delete this.currentDiagram.notes[e]},createType:function(){var e=r.nextId();return this.currentDiagram.types[e]=u(e),this.currentDiagram.types[e]},deleteConnector:function(e){delete this.currentDiagram.connectors[e]}})}),define("utility/svg",["raphael"],function(e){var t=document.getElementById("svg-container"),n=t.offsetWidth,r=t.offsetHeight,i=e("svg-container",n,r);return i.canvas.id="foo",i}),define("utility/svgUtilities",["utility/svg"],function(e){return{NS:"http://www.w3.org/2000/svg",MOVE_TO:"M",SEPARATOR:",",LINETO:"L",SPACE:" ",buildPath:function(e,t){var n="M"+e[0].x+" "+e[0].y+"L";for(var r=1;r<e.length;r++)n+=e[r].x+" ",n+=e[r].y+" ";return t&&(n+="Z"),n},createSVGTextNode:function(e,t){var n=document.createElementNS(this.NS,"text");return n.setAttribute("font-family",t),n.setAttribute("font-size",e),n},createTextBody:function(e,t,n,r,i,s){function a(e,t,n,r,i,s){var a=e.split(/\s/),f=t-n*2,l=[],c=u.createSVGTextNode(i,r),h=document.createElementNS(o,"tspan");s.appendChild(c),c.appendChild(h);var p,d=[];for(var v=0;v<a.length;v++){var m=a[v];l.push(m),p&&h.removeChild(p);var g=l.join(" ");p=document.createTextNode(g),h.appendChild(p);var t=h.getBBox().width;t>f&&(l.pop(),d.push(l.join(" ")),l=[m])}return h.removeChild(p),d.push(l.join(" ")),d}var o=this.NS,u=this,f=a(e,t,n,r,i,s),l=this.createSVGTextNode(i,r);return l.setAttribute("y",i),f.forEach(function(e,t){var r=document.createElementNS(o,"tspan"),i=document.createTextNode(e);r.appendChild(i),r.setAttribute("dy",20),r.setAttribute("x",n),l.appendChild(r)}),l},buildCoods:function(e,t){return{x:e,y:t}},setShapeOpacity:function(e,t){var n=t?1:0;e.attr("opacity",n)},nullObject:function(){return{attr:function(){},remove:function(){}}},createPath:function(t,n){var r=e.path(t);return n&&r.attr({fill:n}),r.attr({stroke:"black"}),r},resetPath:function(e,t){e.attr({path:t})},createCircle:function(t,n){var r=e.circle(t,n,10);return r},resetRectangle:function(e,t,n){e.attr({x:t,y:n})},createText:function(t){e.text(100,100,t)},resetLineStyle:function(e,t){t==="dashed"?e.attr("stroke-dasharray","-"):e.attr({"stroke-dasharray":""})}}}),define("diagram/connectors/nodes/svgArrow",["BaseType","jquery","utility/svgUtilities"],function(e,t,n){return e.extend({initialize:function(e){this.model=e.model,this._createElement()},move:function(){var e=this._getStyle(),t;e==="whiteArrow"?(t=this._buildPath("arrow",!0),n.resetPath(this.element,t)):e==="blackDiamond"?(t=this._buildPath("diamond",!0),n.resetPath(this.element,t)):e==="blackConnectArrow"?(t=this._buildPath("connectArrow",!1),n.resetPath(this.element,t)):e==="whiteDiamond"&&(t=this._buildPath("diamond",!0),n.resetPath(this.element,t))},changeArrowHead:function(){this.element.remove(),this._createElement()},destroy:function(){this.element.remove()},_createElement:function(){var e=this._getStyle(),t;e==="whiteArrow"?(t=this._buildPath("arrow",!0),this.element=n.createPath(t,"white")):e==="blackDiamond"?(t=this._buildPath("diamond",!0),this.element=n.createPath(t,"black")):e==="whiteDiamond"?(t=this._buildPath("diamond",!0),this.element=n.createPath(t,"white")):e==="blackConnectArrow"?(t=this._buildPath("connectArrow",!1),this.element=n.createPath(t)):this.element=n.nullObject()},_buildPath:function(e,t){var r=this._getDirection(),i=this._createPointsArray(e,r);return n.buildPath(i,t)},_getStyle:function(){return this.model.getStyle()},_getDirection:function(){return this.model.getDirection()},_createPointsArray:function(e,t){var n=this.model.getXCood(),r=this.model.getYCood();if(e==="arrow")switch(t){case"top":return[this._getPoint(n,r),this._getPoint(n+10,r+10),this._getPoint(n-10,r+10)];case"bottom":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n-10,r-10)];case"left":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n+10,r+10)];case"right":return[this._getPoint(n,r),this._getPoint(n-10,r+10),this._getPoint(n-10,r-10)]}else if(e==="connectArrow")switch(t){case"top":return[this._getPoint(n+10,r+10),this._getPoint(n,r),this._getPoint(n-10,r+10)];case"bottom":return[this._getPoint(n+10,r-10),this._getPoint(n,r),this._getPoint(n-10,r-10)];case"left":return[this._getPoint(n+10,r-10),this._getPoint(n,r),this._getPoint(n+10,r+10)];case"right":return[this._getPoint(n-10,r+10),this._getPoint(n,r),this._getPoint(n-10,r-10)]}else if(e==="diamond")switch(t){case"top":return[this._getPoint(n,r),this._getPoint(n+10,r+10),this._getPoint(n,r+20),this._getPoint(n-10,r+10)];case"bottom":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n,r-20),this._getPoint(n-10,r-10)];case"left":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n+20,r),this._getPoint(n+10,r+10)];case"right":return[this._getPoint(n,r),this._getPoint(n-10,r+10),this._getPoint(n-20,r),this._getPoint(n-10,r-10)]}},_getPoint:function(e,t){return{x:e,y:t}}})}),define("diagram/connectors/nodes/nodeView",["BaseType","utility/svg","diagram/connectors/nodes/svgArrow"],function(e,t,n){return e.extend({initialize:function(e){this.model=e.model;var r=this.model.getXCood(),i=this.model.getYCood();this.node=t.circle(r,i,10),this.node.attr({fill:"green",opacity:0,stroke:0}),this.model.on("change:xCood",this.updateX,this),this.model.on("change:yCood",this.updateY,this),this.model.on("switchArrowHead",this.switchArrowHead,this),this.model.on("destroy",this.destroy,this),this.model.isArrowNode()&&(this.arrow=new n({model:this.model})),this.node.toFront()},destroy:function(){console.log("node view destroy"),this.model.isArrowNode()&&this.arrow.destroy(),this.node.remove()},switchArrowHead:function(){this.arrow.changeArrowHead(),this.node.toFront()},getSvgNode:function(){return this.node},updateX:function(){var e=this.model.getXCood();this.node.attr({cx:e}),this.arrow&&this.arrow.move(),this.node.toFront()},updateY:function(){var e=this.model.getYCood();this.node.attr({cy:e}),this.arrow&&this.arrow.move(),this.node.toFront()}})}),define("diagram/connectors/nodes/nodeController",["BaseType","underscore"],function(e,t){return e.extend({initialize:function(e){t.bindAll(this,"_onMove","_onStart","_onEnd"),this.view=e.view,this.mediator=e.mediator,this.orientation=e.orientation,this.model=e.model,this.svgNode=this.view.getSvgNode(),this.startX=null,this.startY=null,this.svgNode.dblclick(function(){this.mediator.dblclick()},this),this.svgNode.drag(this._onMove,this._onStart,this._onEnd);var n=this;(this.orientation==="left"||this.orientation==="right"||this.orientation==="top"||this.orientation==="bottom")&&this.svgNode.click(function(e){!e.altKey&&e.shiftKey?n._isAttached()?n.mediator.removeBoxNodeMediator(n.orientation):n.mediator.fireAttachRequest(n.orientation):e.altKey&&e.shiftKey&&n.model.switchArrowHead()}),this.svgNode.click(function(e){e.altKey&&!e.shiftKey&&n.mediator.changeLineStyle()})},_isAttached:function(){return this.model.isAttached()},_onMove:function(e,t){var n=this.startX+e,r=this.startY+t;this.mediator.update(this.orientation,n,r)},_onStart:function(){this.startX=parseInt(this.svgNode.attr("cx")),this.startY=parseInt(this.svgNode.attr("cy"))},_onEnd:function(){this.startX=null,this.startY=null}})}),define("utility/nodeWrapper",["BaseType","backbone","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.model=e.model,this.events={},_.extend(this.events,t.Events),n.on("destroy:"+this.model.id,this.destroy,this)},destroy:function(){this.trigger("destroy")},on:function(){this.events.on.apply(this.events,arguments)},off:function(){this.events.off.apply(this.events,arguments)},trigger:function(){this.events.trigger.apply(this.events,arguments)},set:function(e,t){this.model[e]=t},get:function(e){return this.model[e]}})}),define("diagram/connectors/nodes/nodeModel",["utility/nodeWrapper"],function(e){"use strict";return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.model.arrow&&this.on("change:style",function(){this.trigger("switchArrowHead")},this),this.arrowModel=this.model.arrow,this.arrowHeadStyles=["whiteArrow","whiteDiamond","blackDiamond","blackConnectArrow","none"],this.currentArrowHeadIndex=0},getXCood:function(){return parseInt(this.model.xCood,10)},setXCood:function(e){this.model.xCood=e,this.trigger("change:xCood")},setYCood:function(e){this.model.yCood=e,this.trigger("change:yCood")},getYCood:function(){return parseInt(this.model.yCood,10)},getStyle:function(){return this.model.arrow.style},switchArrowHead:function(){var e=this.arrowHeadStyles[this.currentArrowHeadIndex];this.model.arrow.style=e,this.currentArrowHeadIndex=(this.currentArrowHeadIndex+1)%this.arrowHeadStyles.length,this.trigger("switchArrowHead")},getDirection:function(){return this.model.arrow.direction},setArrowDirection:function(e){this.model.arrow.direction=e},isAttached:function(){return!!this.model.attached},setAttached:function(e){this.model.attached=e},isArrowNode:function(){return!!this.model.arrow}})}),define("diagram/connectors/nodes/abstractNodeMediator",["BaseType","diagram/connectors/nodes/nodeModel","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.selected=!1,this.artifactType="connector",this.connectorModel=e.connectorModel,n.on("destroy",function(){this.connectorModel.trigger("destroy")},this),this.connectorModel.on("destroy",this.destroy,this)},destroyConnector:function(){this.connectorModel.trigger("destroy")},dblclick:function(){n.trigger("dblclick:connector",this.connectorModel)},changeLineStyle:function(){this.connectorModel.alternateLineStyle(),this.connectorModel.trigger("change:lineStyle")},getName:function(){return this.connectorModel.model.name},getConnectorId:function(){return this.connectorModel.model.id}})}),define("diagram/connectors/nodes/horizontalNodesMediator",["diagram/connectors/nodes/abstractNodeMediator","diagram/connectors/nodes/nodeModel","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(t){this.leftArrowModel=t.leftArrowModel,this.proximalNodeModel=t.proximalNodeModel,this.distalNodeModel=t.distalNodeModel,this.rightArrowModel=t.rightArrowModel,e.prototype.initialize.call(this,t)},destroy:function(){this.detachAll(),this.leftArrowModel.trigger("destroy"),this.proximalNodeModel.trigger("destroy"),this.distalNodeModel.trigger("destroy"),this.rightArrowModel.trigger("destroy")},addBoxNodeMediator:function(e,t){t==="left"?this._attachTypeBoxToLeftNode(e):t==="right"&&this._attachTypeBoxToRightNode(e)},removeBoxNodeMediator:function(e){e==="left"?(this.leftArrowModel.setAttached(!1),this.leftArrowModel.model.attachedBox=null,this.leftNodeTypeBoxMediator.destroy(),this.leftNodeTypeBoxMediator=null):(this.rightArrowModel.setAttached(!1),this.rightArrowModel.model.attachedBox=null,this.rightNodeTypeBoxMediator.destroy(),this.rightNodeTypeBoxMediator=null)},detachAll:function(){this.leftNodeTypeBoxMediator&&this.removeBoxNodeMediator("left"),this.rightNodeTypeBoxMediator&&this.removeBoxNodeMediator("right")},_attachTypeBoxToRightNode:function(e){this.rightArrowModel.setAttached(!0);var t=e.typeController.model.model.id;this.rightArrowModel.model.attachedBox=t,this.rightNodeTypeBoxMediator=e},_attachTypeBoxToLeftNode:function(e){this.leftArrowModel.setAttached(!0);var t=e.typeController.model.model.id;this.leftArrowModel.model.attachedBox=t,this.leftNodeTypeBoxMediator=e},update:function(e,t,n,r){switch(e){case"left":this.updateLeftArrow(t,n,r);break;case"proximal":this.updateProximalNode(t,n);break;case"distal":this.updateDistalNode(t,n);break;case"right":this.updateRightArrow(t,n,r)}this.connectorModel.trigger("change")},updateUsingDifference:function(e,t,n){var r,i;switch(e){case"left":r=this.leftArrowModel.getXCood()+t,i=this.leftArrowModel.getYCood()+n;var s=this.proximalNodeModel.getXCood();this.leftArrowModel.setXCood(this.leftNodeTypeBoxMediator.calculateNodeXCood(s)),this._setLeftArrowDirection(),this.leftArrowModel.setYCood(i),this.proximalNodeModel.setYCood(i);break;case"right":r=this.rightArrowModel.getXCood()+t,i=this.rightArrowModel.getYCood()+n;var o=this.distalNodeModel.getXCood();this.rightArrowModel.setXCood(this.rightNodeTypeBoxMediator.calculateNodeXCood(o)),this.setRightArrowDirection(),this.rightArrowModel.setYCood(i),this.distalNodeModel.setYCood(i)}this.connectorModel.trigger("change")},fireAttachRequest:function(e){n.trigger("attachRequest",this,e)},updateLeftArrow:function(e,t,n){if(this._leftArrowAttached()){var r=this.leftArrowModel.getXCood(),i=this.leftArrowModel.getYCood();if(!n){var s=this.leftNodeTypeBoxMediator.getLeftNodeCoods(e,t,r,i);e=s.x,t=s.y}}this.leftArrowModel.setXCood(e),this.leftArrowModel.setYCood(t),this.proximalNodeModel.setYCood(t),this._setLeftArrowDirection()},updateProximalNode:function(e,t){this._rightArrowAttached()&&this.rightArrowModel.setXCood(this.rightNodeTypeBoxMediator.calculateNodeXCood(e));if(this._leftArrowAttached()){var n=this.proximalNodeModel.getXCood(),r=this.proximalNodeModel.getYCood(),i=this.leftNodeTypeBoxMediator.getProximalNodeCoods(e,t,n,r);e=i.x,t=i.y,this.leftArrowModel.setXCood(this.leftNodeTypeBoxMediator.calculateNodeXCood(e))}this.setRightArrowDirection(),this._setLeftArrowDirection(),this.proximalNodeModel.setXCood(e),this.proximalNodeModel.setYCood(t),this.leftArrowModel.setYCood(t),this.distalNodeModel.setXCood(e)},updateDistalNode:function(e,t){if(this._rightArrowAttached()){var n=this.distalNodeModel.getXCood(),r=this.distalNodeModel.getYCood(),i=this.rightNodeTypeBoxMediator.getDistalNodeCoods(e,t,n,r);e=i.x,t=i.y,this.rightArrowModel.setXCood(this.rightNodeTypeBoxMediator.calculateNodeXCood(e))}this._leftArrowAttached()&&this.leftArrowModel.setXCood(this.leftNodeTypeBoxMediator.calculateNodeXCood(e)),this.setRightArrowDirection(),this._setLeftArrowDirection(),this.distalNodeModel.setXCood(e),this.distalNodeModel.setYCood(t),this.proximalNodeModel.setXCood(e),this.rightArrowModel.setYCood(t)},updateRightArrow:function(e,t,n){if(this._rightArrowAttached()&&!n){var r=this.rightArrowModel.getXCood(),i=this.rightArrowModel.getYCood(),s=this.rightNodeTypeBoxMediator.getRightNodeCoods(e,t,r,i);e=s.x,t=s.y}this.rightArrowModel.setXCood(e),this.rightArrowModel.setYCood(t),this.distalNodeModel.setYCood(t),this.setRightArrowDirection()},setRightArrowDirection:function(){this.rightArrowModel.getXCood()<this.proximalNodeModel.getXCood()?this.rightArrowModel.setArrowDirection("left"):this.rightArrowModel.setArrowDirection("right"),this.rightArrowModel.trigger("switchArrowHead")},_setLeftArrowDirection:function(){this.leftArrowModel.getXCood()<this.proximalNodeModel.getXCood()?this.leftArrowModel.setArrowDirection("left"):this.leftArrowModel.setArrowDirection("right"),this.leftArrowModel.trigger("switchArrowHead")},_rightArrowAttached:function(){return this.rightArrowModel.isAttached()},_leftArrowAttached:function(){return this.leftArrowModel.isAttached()}})}),define("diagram/connectors/lines/lineView",["BaseType","utility/svgUtilities"],function(e,t){"use strict";return e.extend({initialize:function(e){this.modelA=e.modelA,this.modelB=e.modelB,this.connectorModel=e.connectorModel,this.line=t.createPath(this.buildPath(),"red"),this.connectorModel.on("change",this.updateLine,this),this.connectorModel.on("change:lineStyle",this.updateLineStyle,this),this.connectorModel.on("selected",this.selectLine,this),this.connectorModel.on("destroy",this.destroy,this)},destroy:function(){this.line.remove()},selectLine:function(){this.line.attr("stroke","orange")},updateLine:function(){t.resetPath(this.line,this.buildPath())},updateLineStyle:function(){t.resetLineStyle(this.line,this.connectorModel.getLineStyle())},buildPath:function(){var e=this.modelA.getXCood(),n=this.modelA.getYCood(),r=this.modelB.getXCood(),i=this.modelB.getYCood();return t.buildPath([{x:e,y:n},{x:r,y:i}],!1)}})}),define("diagram/connectors/horizontalConnectorFactory",["diagram/connectors/nodes/nodeView","diagram/connectors/nodes/nodeController","diagram/connectors/nodes/horizontalNodesMediator","diagram/connectors/lines/lineView","diagram/connectors/nodes/nodeModel"],function(e,t,n,r,i){"use strict";return{create:function(s){var o=s,u=new i({model:o.getLeftArrow()}),a=new i({model:o.getProximalNode()}),f=new i({model:o.getDistalNode()}),l=new i({model:o.getRightArrow()});new r({modelA:u,modelB:a,connectorModel:o}),new r({modelA:a,modelB:f,connectorModel:o}),new r({modelA:f,modelB:l,connectorModel:o});var c=new e({model:u}),h=new e({model:a}),p=new e({model:f}),d=new e({model:l}),v=new n({leftArrowModel:u,proximalNodeModel:a,distalNodeModel:f,rightArrowModel:l,connectorModel:o});return new t({orientation:"left",model:u,mediator:v,view:c}),new t({orientation:"proximal",model:a,mediator:v,view:h}),new t({orientation:"distal",model:f,mediator:v,view:p}),new t({orientation:"right",model:l,mediator:v,view:d}),v}}}),define("diagram/connectors/nodes/verticalNodesMediator",["diagram/connectors/nodes/abstractNodeMediator","diagram/connectors/nodes/nodeModel","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(t){this.topArrowModel=t.topArrowModel,this.secondTopNodeModel=t.secondTopNodeModel,this.secondBottomNodeModel=t.secondBottomNodeModel,this.bottomArrowModel=t.bottomArrowModel,e.prototype.initialize.call(this,t)},destroy:function(){this.detachAll(),this.topArrowModel.trigger("destroy"),this.secondTopNodeModel.trigger("destroy"),this.secondBottomNodeModel.trigger("destroy"),this.bottomArrowModel.trigger("destroy")},addBoxNodeMediator:function(e,t){if(t==="top")this._attachTypeBoxToTopNode(e);else{if(t!=="bottom")throw{name:"IncorrectNodeMediatorAttachmentError"};this._attachTypeBoxToBottomNode(e)}},removeBoxNodeMediator:function(e){console.log("removeBoxNodeMediator",e),e==="top"?(this.topArrowModel.setAttached(!1),this.topArrowModel.model.attachedBox=null,this.topNodeTypeBoxMediator.destroy(),this.topNodeTypeBoxMediator=null):(this.bottomArrowModel.setAttached(!1),this.bottomArrowModel.model.attachedBox=null,this.bottomNodeTypeBoxMediator.destroy(),this.bottomNodeTypeBoxMediator=null)},detachAll:function(){this.topNodeTypeBoxMediator&&this.removeBoxNodeMediator("top"),this.bottomNodeTypeBoxMediator&&this.removeBoxNodeMediator("bottom")},_attachTypeBoxToBottomNode:function(e){this.bottomArrowModel.setAttached(!0);var t=e.typeController.model.model.id;this.bottomArrowModel.model.attachedBox=t,this.bottomNodeTypeBoxMediator=e},_attachTypeBoxToTopNode:function(e){this.topArrowModel.setAttached(!0);var t=e.typeController.model.model.id;this.topArrowModel.model.attachedBox=t,this.topNodeTypeBoxMediator=e},update:function(e,t,n,r){switch(e){case"top":this.updateTopArrow(t,n,r);break;case"secondTop":this.updateSecondTopNode(t,n);break;case"secondBottom":this.updateSecondBottomNode(t,n);break;case"bottom":this.updateBottomArrow(t,n,r)}this.connectorModel.trigger("change")},updateUsingDifference:function(e,t,n){var r,i;switch(e){case"top":r=this.topArrowModel.getXCood()+t,i=this.topArrowModel.getYCood()+n;var s=this.secondTopNodeModel.getYCood();this.topArrowModel.setYCood(this.topNodeTypeBoxMediator.calculateNodeYCood(s)),this._setTopArrowDirection(),this.topArrowModel.setXCood(r),this.secondTopNodeModel.setXCood(r);break;case"bottom":r=this.bottomArrowModel.getXCood()+t,i=this.bottomArrowModel.getYCood()+n;var o=this.secondBottomNodeModel.getYCood();this.bottomArrowModel.setYCood(this.bottomNodeTypeBoxMediator.calculateNodeYCood(o)),this._setBottomArrowDirection(),this.bottomArrowModel.setXCood(r),this.secondBottomNodeModel.setXCood(r)}this.connectorModel.trigger("change")},fireAttachRequest:function(e){n.trigger("attachRequest",this,e)},updateTopArrow:function(e,t,n){if(this._topArrowAttached()){var r=this.topArrowModel.getXCood(),i=this.topArrowModel.getYCood();if(!n){var s=this.topNodeTypeBoxMediator.getTopNodeCoods(e,t,r,i);e=s.x,t=s.y}}this.topArrowModel.setXCood(e),this.topArrowModel.setYCood(t),this.secondTopNodeModel.setXCood(e),this._setTopArrowDirection()},updateSecondTopNode:function(e,t){this._bottomArrowAttached()&&this.bottomArrowModel.setYCood(this.bottomNodeTypeBoxMediator.calculateNodeYCood(t));if(this._topArrowAttached()){var n=this.secondTopNodeModel.getXCood(),r=this.secondTopNodeModel.getYCood(),i=this.topNodeTypeBoxMediator.getSecondTopNodeCoods(e,t,n,r);e=i.x,t=i.y,this.topArrowModel.setYCood(this.topNodeTypeBoxMediator.calculateNodeYCood(t))}this._setBottomArrowDirection(),this._setTopArrowDirection(),this.secondTopNodeModel.setXCood(e),this.secondTopNodeModel.setYCood(t),this.topArrowModel.setXCood(e),this.secondBottomNodeModel.setYCood(t)},updateSecondBottomNode:function(e,t){if(this._bottomArrowAttached()){var n=this.secondBottomNodeModel.getXCood(),r=this.secondBottomNodeModel.getYCood(),i=this.bottomNodeTypeBoxMediator.getSecondBottomNodeCoods(e,t,n,r);e=i.x,t=i.y,this.bottomArrowModel.setYCood(this.bottomNodeTypeBoxMediator.calculateNodeYCood(t))}this._topArrowAttached()&&this.topArrowModel.setYCood(this.topNodeTypeBoxMediator.calculateNodeYCood(t)),this._setTopArrowDirection(),this._setBottomArrowDirection(),this.secondBottomNodeModel.setXCood(e),this.secondBottomNodeModel.setYCood(t),this.secondTopNodeModel.setYCood(t),this.bottomArrowModel.setXCood(e)},updateBottomArrow:function(e,t,n){if(this._bottomArrowAttached()&&!n){var r=this.bottomArrowModel.getXCood(),i=this.bottomArrowModel.getYCood(),s=this.bottomNodeTypeBoxMediator.getBottomNodeCoods(e,t,r,i);e=s.x,t=s.y}this.bottomArrowModel.setXCood(e),this.bottomArrowModel.setYCood(t),this.secondBottomNodeModel.setXCood(e),this._setBottomArrowDirection()},_setBottomArrowDirection:function(){this.bottomArrowModel.getYCood()<this.secondBottomNodeModel.getYCood()?this.bottomArrowModel.setArrowDirection("top"):this.bottomArrowModel.setArrowDirection("bottom"),this.bottomArrowModel.trigger("switchArrowHead")},_setTopArrowDirection:function(){this.topArrowModel.getYCood()<this.secondTopNodeModel.getYCood()?this.topArrowModel.setArrowDirection("top"):this.topArrowModel.setArrowDirection("bottom"),this.topArrowModel.trigger("switchArrowHead")},_topArrowAttached:function(){return this.topArrowModel.isAttached()},_bottomArrowAttached:function(){return this.bottomArrowModel.isAttached()}})}),define("diagram/connectors/verticalConnectorFactory",["BaseType","diagram/connectors/nodes/nodeView","diagram/connectors/nodes/nodeController","diagram/connectors/nodes/horizontalNodesMediator","diagram/connectors/lines/lineView","diagram/connectors/nodes/nodeModel","diagram/connectors/nodes/verticalNodesMediator"],function(e,t,n,r,i,s,o){"use strict";return{create:function(e){var r=e,u=new s({model:r.getTopArrow()}),a=new s({model:r.getSecondTopNode()}),f=new s({model:r.getSecondBottomNode()}),l=new s({model:r.getBottomArrow()});new i({modelA:u,modelB:a,connectorModel:r}),new i({modelA:a,modelB:f,connectorModel:r}),new i({modelA:f,modelB:l,connectorModel:r});var c=new t({model:u}),h=new t({model:a}),p=new t({model:f}),d=new t({model:l}),v=new o({topArrowModel:u,secondTopNodeModel:a,secondBottomNodeModel:f,bottomArrowModel:l,connectorModel:r});return new n({orientation:"top",model:u,mediator:v,view:c}),new n({orientation:"secondTop",model:a,mediator:v,view:h}),new n({orientation:"secondBottom",model:f,mediator:v,view:p}),new n({orientation:"bottom",model:l,mediator:v,view:d}),v}}}),define("utility/typeBox",["utility/svg","BaseType","underscore"],function(e,t,n){return t.extend({paddingTop:10,lineHeight:15,paddingLeft:5,paddingRight:5,paddingBottom:10,separatorYOffset:7,backgroundColor:"#ffffce",outlineColor:"#666",nameTextYOffset:null,propertiesYOffset:null,methodsYOffset:null,svgMethodTextArray:null,svgPropertyTextArray:null,initialize:function(t){this.model=t.model;var n=this.model.getXCood(),r=this.model.getYCood(),i=this.model.getName();this._calculateGeometry(),this.typeBox=e.rect(n,r,500,500),this.svgMethodTextArray=[],this.svgPropertyTextArray=[],this.typeBox.attr("fill",this.backgroundColor),this.typeBox.attr("stroke",this.outlineColor);if(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")this.flavorText=this.createFlavorText(this.model.getFlavor());this.nameText=this.createNameText(i),this.createProperties(),this.createMethods();var s=this._calculateWidth(),o=this._calculateHeight();this.rect=e.rect(n,r,500,500),this.rect.attr({fill:"red",opacity:0}),this.rect.attr({width:s,height:o}),this.typeBox.attr({width:s,height:o})},destroy:function(){this.removeContents(),this.typeBox.remove(),this.rect.remove()},_calculateWidth:function(){var e=0,t=this.svgMethodTextArray.concat(this.svgPropertyTextArray,this.nameText);return(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")&&t.push(this.flavorText),n.each(t,function(t){var n=t.getBBox().width;e=n>e?n:e}),e=e+this.paddingLeft+this.paddingRight,this.model.setWidth(e),e},_calculateHeight:function(){var e=n.size(this.model.getMethods())*this.lineHeight+this.methodsYOffset+this.paddingBottom;return this.model.setHeight(e),e},_calculateGeometry:function(){var e=0;if(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")e=this.lineHeight;this.nameTextYOffset=this.paddingTop+e,this.propertiesYOffset=this.nameTextYOffset+this.lineHeight+this.separatorYOffset;var t=n.size(this.model.getProperties());this.methodsYOffset=this.propertiesYOffset+this.separatorYOffset+t*this.lineHeight},createNameText:function(t){var n=this.model.getXCood(),r=this.model.getYCood(),i=e.text(this.paddingLeft+n,r+this.nameTextYOffset,t);return i.attr({"text-anchor":"start"}),i},createProperties:function(){var t=this.formatProperties(this.model.getProperties()),r,i=this.model.getXCood(),s=this.model.getYCood();n.each(t,function(t,n){r=n*this.lineHeight;var o=e.text(i+this.paddingLeft,s+this.propertiesYOffset+r,t);o.attr({"text-anchor":"start"}),this.svgPropertyTextArray.push(o)},this)},createMethods:function(){var t=this.formatMethods(this.model.getMethods()),r,i=this.model.getXCood(),s=this.model.getYCood();n.each(t,function(t,n){r=n*this.lineHeight;var o=e.text(i+this.paddingLeft,s+this.methodsYOffset+r,t);o.attr({"text-anchor":"start"}),this.svgMethodTextArray.push(o)},this)},moveMethods:function(e,t){var r;n.each(this.svgMethodTextArray,function(n,i){r=i*this.lineHeight,n.attr({x:e+this.paddingLeft}),n.attr({y:t+this.methodsYOffset+r})},this)},removeContents:function(){this.nameText.remove(),this.flavorText&&this.flavorText.remove();var e=this.svgMethodTextArray.concat(this.svgPropertyTextArray);n.each(e,function(e){e.remove()}),this.svgMethodTextArray=[],this.svgPropertyTextArray=[]},moveProperties:function(){var e=this.model.getXCood(),t=this.model.getYCood(),r;n.each(this.svgPropertyTextArray,function(n,i){r=i*this.lineHeight,n.attr({x:e+this.paddingLeft}),n.attr({y:t+this.propertiesYOffset+r})},this)},moveNameText:function(){var e=this.model.getXCood(),t=this.model.getYCood();this.nameText.attr({x:this.paddingLeft+e,y:t+this.nameTextYOffset})},createFlavorText:function(t){var n=this.model.getXCood(),r=this.model.getYCood();t="<<"+t+">>";var i=e.text(this.paddingLeft+n,r+this.paddingTop,t);return i.attr({"text-anchor":"start"}),i},moveFlavorText:function(e,t){this.flavorText.attr({x:this.paddingLeft+e,y:t+this.paddingTop})},move:function(){var e=this.model.getXCood(),t=this.model.getYCood();this.rect.attr({x:e}),this.rect.attr({y:t}),this.typeBox.attr({x:e}),this.typeBox.attr({y:t}),this.moveNameText(e,t),(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")&&this.moveFlavorText(e,t),this.moveMethods(e,t),this.moveProperties(e,t)},update:function(){this.removeContents(),this._calculateGeometry(),this.createProperties(),this.createMethods();if(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")this.flavorText=this.createFlavorText(this.model.getFlavor());this.nameText=this.createNameText(this.model.getName());var e=this._calculateWidth(),t=this._calculateHeight();this.rect.attr({width:e,height:t}),this.typeBox.attr({width:e,height:t})},formatProperties:function(e){return n.map(e,function(e){var t="";return t+=this._convertVisibility(e.visibility),t+=e.name,t+=":",t+=e.type,t},this)},formatMethods:function(e){function t(e){var t="";return n.each(e,function(e){t+=e.name+":"+e.type+","}),t.substring(0,t.length-1)}return n.map(e,function(e){var n="",r;return r=t(e.args),n+=this._convertVisibility(e.visibility),n+=e.name,n+="("+r+"):",n+=e.returnType,n},this)},_convertVisibility:function(e){switch(e){case"private":return"-";case"protected":return"#";case"public":return"+";default:return"-"}}})}),define("diagram/types/typeView",["BaseType","utility/typeBox"],function(e,t){return e.extend({initialize:function(e){this.model=e.model,this.model.on("update:position",this.move,this),this.model.on("update",this.update,this),this.model.on("destroy",this.destroy,this),this.box=new t({model:this.model,x:100,y:200,width:100,height:50})},destroy:function(){this.box.destroy()},getElement:function(){return this.box},move:function(){this.box.move()},update:function(){this.box&&this.box.update()}})}),define("diagram/types/typeController",["BaseType","underscore","events/eventsBus"],function(e,t,n){return e.extend({initialize:function(e){t.bindAll(this,"_onMove","_onStart","_onEnd"),this.attachedNodesMediators=[],this.startX=null,this.startY=null,this.model=e.model,this.artifactType="type",this.view=e.view,this.box=this.view.box.rect,this.box.drag(this._onMove,this._onStart,this._onEnd),n.on("destroy",this.onGlobalDestroy,this),this.model.on("destroy",this.destroy,this),this.box.click(function(){n.trigger("receiveRequest",this)},this),this.box.dblclick($.proxy(function(){n.trigger("dblclick:type",this.model)},this))},onGlobalDestroy:function(){this.model.trigger("destroy")},getName:function(){return this.model.model.name},destroy:function(){console.log("typeController:destroy()");while(this.attachedNodesMediators.length){var e=this.attachedNodesMediators[0];e.destroyConnector()}},getTopYLimit:function(){return this.model.getYCood()},getBottomYLimit:function(){return this.model.getYCood()+this.model.getHeight()},getLeftXLimit:function(){return this.model.getXCood()},getRightXLimit:function(){return this.model.getXCood()+this.model.getWidth()},_onMove:function(e,n){var r=this.startX+e,i=this.startY+n,s=this.model.getXCood(),o=this.model.getYCood(),u=r-s,a=i-o;this.model.setCoods(r,i),t.each(this.attachedNodesMediators,function(e){e.moveNode(u,a)})},_onStart:function(){this.startX=parseInt(this.box.attr("x"),10),this.startY=parseInt(this.box.attr("y"),10)},_onEnd:function(){this.startX=null,this.startY=null},addAttachedNodeMediator:function(e){this.attachedNodesMediators.push(e)},removeAttachedMediators:function(){var e=this.attachedNodesMediators.length;for(var t=0;t<e;t++){var n=this.attachedNodesMediators[0];"destroyFromType"in n?n.destroyFromType():console.log("destroyFromType not on mediator")}},unAttachNodeMediator:function(e){t.each(this.attachedNodesMediators,function(t,n){t===e&&this.attachedNodesMediators.splice(n,1)},this)}})}),define("diagram/types/typeModel",["utility/nodeWrapper"],function(e){"use strict";return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.diagramModel=t.diagramModel},getName:function(){return this.model.name},save:function(){this.trigger("update")},setCoods:function(e,t){this.set("xCood",e),this.set("yCood",t),this.trigger("update:position")},setWidth:function(e){var t=this.getWidth();this.set("width",e),t!==e&&this.trigger("changeWidth")},setHeight:function(e){var t=this.getHeight();this.set("height",e),t!==e&&this.trigger("changeHeight")},getHeight:function(){return this.get("height")},getWidth:function(){return this.get("width")},getFlavor:function(){return this.get("flavor")},getXCood:function(){return this.get("xCood")},getYCood:function(){return this.get("yCood")},getTypeName:function(){return this.get("name")},getMethods:function(){return this.model.methods},getProperties:function(){return this.model.properties}})}),define("diagram/connectors/horizontalConnectorModel",["utility/nodeWrapper"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.model=t.model,this.lineStyles=["dashed","solid"],this.currentLineStyleIndex=0},getLeftArrow:function(){return this.model.nodes.left},getProximalNode:function(){return this.model.nodes.proximal},getDistalNode:function(){return this.model.nodes.distal},getRightArrow:function(){return this.model.nodes.right},alternateLineStyle:function(){this.setLineStyle(this.lineStyles[this.currentLineStyleIndex]),this.currentLineStyleIndex=(this.currentLineStyleIndex+1)%this.lineStyles.length},setLineStyle:function(e){this.model.lineStyle=e},getLineStyle:function(){return this.model.lineStyle}})}),define("diagram/connectors/verticalConnectorModel",["utility/nodeWrapper"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.model=t.model,this.lineStyles=["dashed","solid"],this.currentLineStyleIndex=0},getTopArrow:function(){return this.model.nodes.top},getSecondTopNode:function(){return this.model.nodes.secondTop},getSecondBottomNode:function(){return this.model.nodes.secondBottom},getBottomArrow:function(){return this.model.nodes.bottom},alternateLineStyle:function(){this.setLineStyle(this.lineStyles[this.currentLineStyleIndex]),this.currentLineStyleIndex=(this.currentLineStyleIndex+1)%this.lineStyles.length},setLineStyle:function(e){this.model.lineStyle=e},getLineStyle:function(){return this.model.lineStyle}})}),define("utility/banner",["utility/svg","BaseType","underscore","utility/svgUtilities"],function(e,t,n,r){"use strict";return t.extend({initialize:function(t){var n=t.author,i=t.fontFamily,s=t.description,o=t.paddingHorizontal,u=t.titleFontSize,a=t.titleFontFamily,f=t.width,l=t.titleText,c=12,h=t.xCood,p=t.yCood,d=r.NS;e.canvas.id="foo",this.svg=document.getElementById("foo"),this.group=document.createElementNS(d,"g"),this.svg.appendChild(this.group),this._createBanner(n,i,s,o,u,a,f,l,c,this.group,this.svg),this.height=this.group.getBBox().height,this.group.setAttribute("transform","translate("+h+" ,"+p+")")},show:function(){this.group.setAttribute("visibility","visible")},hide:function(){this.group.setAttribute("visibility","hidden")},destroy:function(){this.svg.removeChild(this.group)},redraw:function(e,t,n,r,i,s,o,u,a){while(this.group.firstChild)this.group.removeChild(this.group.firstChild);this._createBanner(e,t,n,r,i,s,o,u,a,this.group,this.svg),this.height=this.group.getBBox().height},_createBanner:function(e,t,n,i,s,o,u,a,f,l,c,h,p){function v(e,n,i,s,o,u,a,l,c,h,p){var d=b(u),v=m(s,o,u,a),n=r.createTextBody(n,u,i,t,f,c),e=y(e,t,i);l.appendChild(d),l.appendChild(v),l.appendChild(n),l.appendChild(e);var g=v.getBBox().height,w=n.getBBox().height,E=10;n.setAttribute("y",g),e.setAttribute("y",g+w+s+E);var S=e.getBBox().height,x=10;return d.setAttribute("height",g+w+s+S+x),d}function m(e,t,n,i){var s=r.createSVGTextNode(e,t);s.setAttribute("y",e),s.setAttribute("text-anchor","middle"),s.setAttribute("x",n/2);var o=document.createTextNode(i);return s.appendChild(o),s}function g(e,t){var n=segmentText(e,t),i=r.createSVGTextNode(e.fontSize,e.fontFamily);return i.setAttribute("y",e.title.fontSize),n.forEach(function(t,n){var r=document.createElementNS(d,"tspan"),s=document.createTextNode(t);r.appendChild(s),r.setAttribute("dy",20),r.setAttribute("x",e.paddingHorizontal),i.appendChild(r)}),i}function y(e,t,n){var i=r.createSVGTextNode(10,t);i.setAttribute("x",n);var s=document.createTextNode("author: "+e);return i.appendChild(s),i}function b(e){var t=document.createElementNS(d,"rect");return t.setAttribute("fill","white"),t.setAttribute("width",e),t.setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("stroke","black"),t.setAttribute("stroke-width",1),t}var d=r.NS;this.banner=v(e,n,i,s,o,u,a,l,c,h,p)},setCoods:function(e,t){this.group.setAttribute("transform","translate("+e+" ,"+t+")")},setSelected:function(){this.banner.setAttribute("fill","green")},setDeselected:function(){this.banner.setAttribute("fill","white")}})}),define("diagram/banner/bannerView",["BaseType","utility/banner"],function(e,t){return e.extend({initialize:function(e){this.model=e.model,this.svgElement=new t({author:this.model.getAuthor(),fontFamily:this.model.getFontFamily(),description:this.model.getDescription(),paddingHorizontal:this.model.getPaddingHorizontal(),titleFontSize:this.model.getTitleFontSize(),titleFontFamily:this.model.getTitleFontFamily(),width:this.model.getWidth(),titleText:this.model.getTitleText(),xCood:this.model.getXCood(),yCood:this.model.getYCood()}),this.svgElement.hide(),this.model.height=this.svgElement.height,this.model.on("update:position",this.updateLocation,this),this.model.on("selected",this.select,this),this.model.on("deselected",this.deselect,this),this.model.on("change",this.render,this),this.model.on("destroy",this.destroy,this),this.model.on("showbanner",this.show,this),this.show()},updateLocation:function(){this.svgElement.setCoods(this.model.getXCood(),this.model.getYCood())},show:function(){this.svgElement.show()},destroy:function(){this.model.off(),this.svgElement.destroy()},deselect:function(){this.svgElement.setDeselected()},select:function(){this.svgElement.setSelected()},render:function(){var e=this.model.getAuthor(),t=this.model.getFontFamily(),n=this.model.getDescription(),r=this.model.getPaddingHorizontal(),i=this.model.getTitleFontSize(),s=this.model.getFontFamily(),o=this.model.getWidth(),u=this.model.getTitleText(),a=12;this.svgElement.redraw(e,t,n,r,i,s,o,u,a)}})}),define("diagram/banner/bannerController",["BaseType","utility/svg","events/eventsBus"],function(e,t,n){"use strict";return e.extend({initialize:function(e){this.artifactType="banner",this.model=e.model,this.view=e.view,this.proxyEl=this._createProxyEl(),this.proxyEl.dblclick(function(){n.trigger("dblclick:banner",this.model)},this),n.on("destroy",this.onGlobalDestroy,this),this.model.on("destroy",this.destroy,this)},_createProxyEl:function(){var e=t.rect(this.model.getXCood(),this.model.getYCood(),this.model.getWidth(),this.model.height);return e.attr({fill:"red",opacity:0}),this._dragger(e),e},onGlobalDestroy:function(){this.model.trigger("destroy")},destroy:function(){this.proxyEl.remove()},_dragger:function(t){function i(e,i){var s=n+e,o=r+i;t.attr({x:s,y:o}),this.model.setCoods(s,o)}function s(){n=parseInt(t.attr("x")),r=parseInt(t.attr("y"))}function o(){n=null,r=null}var n,r;t.drag($.proxy(i,this),s,o),t.attr("cursor","move")}})}),define("diagram/banner/bannerModel",["utility/nodeWrapper"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.height=100},save:function(e){this.setTitle(e.title),this.setCreated(e.created),this.setAuthor(e.author),this.setDescription(e.description),this.trigger("showbanner")},getXCood:function(){return parseInt(this.get("xCood"),10)},setCoods:function(e,t){this.setXCood(e),this.setYCood(t),this.trigger("update:position")},setXCood:function(e){this.set("xCood",e)},setYCood:function(e){this.set("yCood",e)},getYCood:function(){return parseInt(this.get("yCood"),10)},setDescription:function(e){this.set("description",e)},getAuthor:function(){return this.get("author")},setAuthor:function(e){this.set("author",e)},getFontFamily:function(){return"arial"},getDescription:function(){return this.get("description")},getPaddingHorizontal:function(){return 12},getCreated:function(){return this.get("created")},setCreated:function(e){this.set("created",e)},getTitleFontSize:function(){return 12},getTitleFontFamily:function(){return"arial"},getWidth:function(){return 300},getTitleText:function(){return this.get("title")},setTitle:function(e){this.set("title",e)}})}),define("utility/note",["utility/svg","BaseType","underscore","utility/svgUtilities"],function(e,t,n,r){"use strict";return t.extend({initialize:function(e){this.svg=document.getElementById("foo");var t=0,n=0;this.x=t,this.y=n,this.width=e.width,this.height=e.height;var i=10;this.fold=i;var s=this._buildMainPath(t,n,i,this.width,this.height),o=r.buildPath([r.buildCoods(t,n+i),r.buildCoods(t+i,n+i),r.buildCoods(t+i,n)]),u=this.createPathEl(s,"white"),a=this.createPathEl(o,"white");u.setAttribute("stroke","#666"),u.setAttribute("stroke-width",1),a.setAttribute("stroke","#666"),a.setAttribute("stroke-width",1),this.foo=u;var f=this.createGroup();this.group=f,this.svg.appendChild(f),this.text=r.createTextBody(e.text,this.width,12,"arial",12,this.svg),f.appendChild(u),f.appendChild(a),f.appendChild(this.text),this.height=this.resetHeight(t,n),this.setCoods(e.xCood,e.yCood)},update:function(e,t){this.resetText(e,t),this.width=t,this.height=this.resetHeight(0,0)},resetText:function(e,t){this.group.removeChild(this.text),this.text=r.createTextBody(e,t,12,"arial",12,this.svg),this.group.appendChild(this.text)},destroy:function(){this.svg.removeChild(this.group)},setSelected:function(){this.foo.setAttribute("fill","orange")},setDeselected:function(){this.foo.setAttribute("fill","white")},resetBoxSize:function(e,t,n,r){this.foo.setAttribute("d",this._buildMainPath(e,t,this.fold,n,r))},_buildMainPath:function(e,t,n,i,s){return r.buildPath([r.buildCoods(e,t+n),r.buildCoods(e+n,t),r.buildCoods(e+i,t),r.buildCoods(e+i,t+s),r.buildCoods(e,t+s)],!0)},resetHeight:function(e,t){var n=this.text.getBBox().height+50;return this.resetBoxSize(e,t,this.width,n),n},setCoods:function(e,t){this.group.setAttribute("transform","translate("+e+" ,"+t+")")},createGroup:function(){return document.createElementNS(r.NS,"g")},createPathEl:function(e,t){var n=document.createElementNS(r.NS,"path");return n.setAttribute("d",e),n.setAttribute("fill",t),n}})}),define("diagram/note/noteView",["BaseType","utility/note"],function(e,t){return e.extend({initialize:function(e){this.model=e.model,this.model.on("update:position",this.updateLocation,this),this.model.on("save",this.update,this),this.svgElement=new t({width:this.model.getWidth(),height:this.model.height,text:this.model.getText(),xCood:this.model.getXCood(),yCood:this.model.getYCood()}),this.model.setHeight(this.svgElement.height),this.model.on("destroy",this.destroy,this)},destroy:function(){this.model.off("update:position",this.updateLocation,this),this.model.off("save",this.update,this),this.model.off("destroy",this.destroy,this),this.svgElement.destroy()},updateLocation:function(){this.svgElement.setCoods(this.model.getXCood(),this.model.getYCood())},update:function(){this.svgElement.update(this.model.getText(),this.model.get("width")),this.model.setHeight(this.svgElement.height)}})}),define("diagram/note/noteModel",["utility/nodeWrapper"],function(e){"use strict";return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.x=0,this.y=0,this.height=100},getHeight:function(){return this.height},getWidth:function(){return this.get("width")},setText:function(e){this.set("text",e)},save:function(e,t){this.setText(e),this.setWidth(t),this.trigger("save"),this.trigger("update:position")},setWidth:function(e){isNaN(parseInt(e,10))?this.set("width",200):this.set("width",e)},getText:function(){return this.get("text")},getType:function(){return this.get("type")},setCoods:function(e,t){this.setXCood(e),this.setYCood(t),this.trigger("update:position")},setXCood:function(e){this.set("xCood",e)},setYCood:function(e){this.set("yCood",e)},getXCood:function(){return parseInt(this.get("xCood"),10)},getYCood:function(){return parseInt(this.get("yCood"),10)},setHeight:function(e){this.height=e,this.trigger("change:dimensions")}})}),define("diagram/note/noteController",["BaseType","utility/svg","jquery","events/eventsBus"],function(e,t,n,r){return e.extend({initialize:function(e){this.artifactType="note",this.model=e.model,this.view=e.view,this.proxyEl=this._createProxyEl(),this.proxyEl.dblclick(n.proxy(function(){r.trigger("dblclick:note",this.model)},this)),r.on("destroy",function(){this.model.trigger("destroy")},this),this.model.on("destroy",this.destroy,this),this.model.on("change:dimensions",this.updateProxyEl,this)},_createProxyEl:function(){var e=t.rect(this.model.getXCood(),this.model.getYCood(),this.model.getWidth(),this.model.height);return e.attr({fill:"red",opacity:0}),this._dragger(e),e},updateProxyEl:function(){this.proxyEl.attr({width:this.model.getWidth(),height:this.model.height})},destroy:function(){this.proxyEl.remove()},_dragger:function(t){function s(e,n){var s=r+e,o=i+n;t.attr({x:s,y:o}),this.model.setCoods(s,o)}function o(){r=parseInt(t.attr("x")),i=parseInt(t.attr("y"))}function u(){r=null,i=null}var r,i;t.drag(n.proxy(s,this),o,u),t.attr("cursor","move")},getName:function(){return this.model.model.name}})}),define("utility/notePath",["utility/svg","BaseType","underscore","utility/svgUtilities"],function(e,t,n,r){"use strict";return t.extend({initialize:function(e){this.svg=document.getElementById("foo");var t=r.buildPath([r.buildCoods(e.x1,e.y1),r.buildCoods(e.x2,e.y2)],!1);this.foo=this.createPathEl(t),this.timestamp=new Date,this.svg.insertBefore(this.foo,this.svg.firstChild)},destroy:function(){this.svg.removeChild(this.foo)},update:function(e,t,n,r){var i=this._createPathString(e,t,n,r);this.foo.setAttribute("d",i)},createPathEl:function(e){var t=document.createElementNS(r.NS,"path");return t.setAttribute("d",e),t.setAttribute("stroke","black"),t.setAttribute("stroke-width","1"),t.setAttribute("stroke-dasharray","1,1"),t},_createPathString:function(e,t,n,i){return r.buildPath([r.buildCoods(e,t),r.buildCoods(n,i)],!1)}})}),define("diagram/note/noteLineView",["BaseType","utility/notePath"],function(e,t){return e.extend({initialize:function(e){this.model=e.model,this.typeModel=e.typeModel,this.width=this.model.getWidth(),this.height=this.model.height;var n=this._calculateX1(),r=this._calculateY1(),i=this._calculateX2(),s=this._calculateY2();this.svgElement=new t({x1:n,y1:r,x2:i,y2:s}),this.timestamp=new Date,this.model.on("update:position",this.update,this),this.model.on("destroy",this.destroy,this),this.typeModel.on("update:position",this.update,this)},destroy:function(){this.typeModel.off("move",this.update),this.model.off("destroy",this.destroy,this),this.svgElement.destroy()},_calculateX1:function(){return this.typeModel.getXCood()+this.typeModel.getWidth()/2},_calculateY1:function(){return this.typeModel.getYCood()+this.typeModel.getHeight()/2},_calculateX2:function(){return this.model.getXCood()+this.model.get("width")/2},_calculateY2:function(){return this.model.getYCood()+this.model.height/2},update:function(){this.svgElement.update(this._calculateX1(),this._calculateY1(),this._calculateX2(),this._calculateY2())}})}),define("diagram/componentFactory",["BaseType","diagram/types/typeView","diagram/types/typeController","diagram/types/typeModel","diagram/connectors/horizontalConnectorModel","diagram/connectors/verticalConnectorModel","diagram/boxHorizontalNodeMediator","diagram/boxVerticalNodeMediator","underscore","diagram/banner/bannerView","diagram/banner/bannerController","diagram/banner/bannerModel","diagram/note/noteView","diagram/note/noteModel","diagram/note/noteController","diagram/note/noteLineView","events/eventsBus"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){return e.extend({initialize:function(e){this.diagramModel=e.diagramModel,this.horizontalConnectorFactory=e.horizontalConnectorFactory,this.verticalConnectorFactory=e.verticalConnectorFactory,this.typeControllerMap={},this.connectorMediators={},this.banner={}},createNote:function(e){var t=this.diagramModel.createNote(e.model.id);return this.createNoteFromModel(t,e),t.id},createNoteFromModel:function(e,t){var n=new p({model:e});new v({model:n,typeModel:t});var r=new h({model:n});new d({model:n,view:r})},createBanner:function(e){e||(e=this.diagramModel.createBanner());if(!this.bannerEditor){var t=new c({model:e}),n=new f({model:t}),r=new l({view:n,model:t});return t}alert("banner already exists")},createType:function(e){e||(e=this.diagramModel.createType());var i=new r({model:e}),s=new t({model:i}),o=new n({model:i,view:s});this.typeControllerMap[e.id]=o},deleteDiagram:function(e){a.each(this.typeControllerMap,function(e,t){this.deleteType(t)},this),a.each(this.connectorMediators,function(e,t){this.deleteConnector(t)},this),this.diagramModel.deleteDiagram(e)},createDiagram:function(e,t){if(!e)this.diagramModel.currentDiagram={name:t,types:{},connectors:{},notes:{}};else{this.diagramModel.currentDiagram=e;var n=this.diagramModel.currentDiagram.types;for(var r in n)this.createType(n[r]);var i=this.diagramModel.currentDiagram.notes;for(var s in i){var a=this.typeControllerMap[i[s].typeId].model;this.createNoteFromModel(i[s],a)}m.trigger("createnotes");var f=this.diagramModel.currentDiagram.banner;this.createBanner(f);var l=this.diagramModel.currentDiagram.connectors;for(var c in l)if(l[c].orientation==="horizontal"){var h=this.createHorizontalConnector(l[c]),p=l[c].nodes.left,d=l[c].nodes.right;if(d.attached){var v=d.attachedBox;new o({nodeMediator:h,nodeOrientation:"right",typeController:this.typeControllerMap[v],dontMove:!0})}if(p.attached){var v=p.attachedBox;new o({nodeMediator:h,nodeOrientation:"left",typeController:this.typeControllerMap[v],dontMove:!0})}}else{var h=this.createVerticalConnector(l[c]),g=l[c].nodes.top,y=l[c].nodes.bottom;if(g.attached){var v=g.attachedBox;new u({nodeMediator:h,nodeOrientation:"top",typeController:this.typeControllerMap[v],dontMove:!0})}if(y.attached){var v=y.attachedBox;new u({nodeMediator:h,nodeOrientation:"bottom",typeController:this.typeControllerMap[v],dontMove:!0})}}}},createHorizontalConnector:function(e){e||(e=this.diagramModel.createHorizontalConnector());var t=new i({model:e}),n=this.horizontalConnectorFactory.create(t);return this.connectorMediators[t.model.name]=n,n},createVerticalConnector:function(e){e||(e=this.diagramModel.createVerticalConnector());var t=new s({model:e}),n=this.verticalConnectorFactory.create(t);return this.connectorMediators[t.model.name]=n,n}})}),define("bootstrap",["jquery","diagram/diagramController","diagram/diagramModel","diagram/connectors/horizontalConnectorFactory","diagram/connectors/verticalConnectorFactory","diagram/componentFactory"],function(e,t,n,r,i,s){return{start:function(){e(document).ready(function(){var e=new n,o=new s({diagramModel:e,horizontalConnectorFactory:r,verticalConnectorFactory:i}),u=new t({diagramModel:e,componentFactory:o});u.setDiagram("builderPattern")})}}});