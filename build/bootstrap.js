define("BaseType",[],function(){return{extend:function(e){var t=function(e){this.initialize&&typeof this.initialize=="function"&&this.initialize(e)},n=function(){};n.prototype=this.prototype,t.prototype=new n;for(var r in e)e.hasOwnProperty(r)&&(t.prototype[r]=e[r]);return t.extend=this.extend,t}}}),define("diagram/diagramController",["BaseType","canvg"],function(e,t){return e.extend({initialize:function(e){this.diagramModel=e.diagramModel,this.contextPath=[],this.componentFactory=e.componentFactory},remove:function(){var e=arguments[0];switch(e){case"diagram":if(!this.diagramModel.checkDiagramExists(arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.componentFactory.deleteDiagram(arguments[1]),this.contextPath=[];break;case"type":if(this.contextPath.length!==2)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkTypeExists(this.contextPath[1],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.componentFactory.deleteType(arguments[1]);break;case"property":if(this.contextPath.length!==4)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkPropertyExists(this.contextPath[1],this.contextPath[3],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.diagramModel.deleteProperty(this.contextPath[1],this.contextPath[3],arguments[1]).fire("deleteProperty");break;case"method":if(this.contextPath.length!==4)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkMethodExists(this.contextPath[1],this.contextPath[3],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.diagramModel.deleteMethod(this.contextPath[1],this.contextPath[3],arguments[1]).fire("deleteMethod");break;case"arg":if(this.contextPath.length!==6||this.contextPath[4]!=="method")throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkArgExists(this.contextPath[1],this.contextPath[3],this.contextPath[5],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.diagramModel.deleteArg(this.contextPath[1],this.contextPath[3],this.contextPath[5],arguments[1]).fire("deleteArgs");break;case"connector":if(!(this.contextPath.length>=2))throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkConnectorExists(this.contextPath[1],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.componentFactory.deleteConnector(arguments[1]);break;default:throw{name:"ArtifactTypeDoesNotExistException",message:"No such artifact type as "+e}}},use:function(){var e=arguments[0];switch(e){case"diagram":if(arguments.length===2){if(this.contextPath.length!==0)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkDiagramExists(arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.contextPath.push("diagram"),this.contextPath.push(arguments[1])}else{if(!(this.contextPath.length>2))throw{name:"ContextPathError",message:"context path is: "+this.contextPath};this.contextPath=this.contextPath.slice(0,2)}break;case"type":if(arguments.length===2){if(this.contextPath.length!==2)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkTypeExists(this.contextPath[1],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.contextPath.push("type"),this.contextPath.push(arguments[1])}else this.contextPath=this.contextPath.slice(0,4);break;case"property":if(arguments.length===2){if(this.contextPath.length!==4)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkPropertyExists(this.contextPath[1],this.contextPath[3],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.contextPath.push("property"),this.contextPath.push(arguments[1])}break;case"method":if(arguments.length===2){if(this.contextPath.length!==4)throw{name:"ContextPathError",message:"context path is: "+this.contextPath};if(!this.diagramModel.checkMethodExists(this.contextPath[1],this.contextPath[3],arguments[1]))throw{name:"ArtifactDoesNotExistException",message:"This artifact does not exist"};this.contextPath.push("method"),this.contextPath.push(arguments[1])}break;default:throw{name:"UnknownArtifactError",message:e+" not known"}}},create:function(){var e=arguments[0];switch(e){case"connector":if(!this.contextPath[1]||!this.diagramModel.checkDiagramExists(this.contextPath[1]))throw{name:"ContextPathError",message:"diagram does not exist or context path is not set"};if(arguments[1]==="horizontal")this.componentFactory.createHorizontalConnector(this.contextPath[1]);else{if(arguments[1]!=="vertical")throw{name:"IncorrectArgumentException",message:"argument must be either horizontal or vertical"};this.componentFactory.createVerticalConnector(this.contextPath[1])}break;case"diagram":if(this.contextPath.length!==0)throw{name:"ContextPathException",message:"context path is: "+this.contextPath};if(!arguments[1]||arguments[1]==="")throw{name:"IncorrectArgumentException",message:"You must supply a diagram name"};this.componentFactory.createDiagram(arguments[1]);break;case"type":if(this.contextPath.length!==2)throw{name:"ContextPathException",message:"context path is: "+this.contextPath};if(!arguments[1]||arguments[1]==="")throw{name:"IncorrectArgumentException",message:"You must supply a type name"};this.componentFactory.createType(this.contextPath[1],arguments[1]);break;case"property":if(this.contextPath.length!==4)throw{name:"ContextPathException",message:"context path is: "+this.contextPath};if(!arguments[1]||arguments[1]==="")throw{name:"IncorrectArgumentException",message:"You must supply a property name"};this.componentFactory.createProperty(this.contextPath[1],this.contextPath[3],arguments[1]);break;case"method":if(this.contextPath.length!==4)throw{name:"ContextPathException",message:"context path is: "+this.contextPath};if(!arguments[1]||arguments[1]==="")throw{name:"IncorrectArgumentException",message:"You must supply a method name"};this.componentFactory.createMethod(this.contextPath[1],this.contextPath[3],arguments[1]);break;case"arg":if(this.contextPath.length!==6&&this.contextPath[4]!=="method")throw{name:"ContextPathException",message:"context path is: "+this.contextPath};if(!arguments[1]||!arguments[2])throw{name:"IncorrectArgumentException",message:"You must supply an argument name and value"};this.diagramModel.createArg(this.contextPath[1],this.contextPath[3],this.contextPath[5],arguments[1],arguments[2]);break;default:throw{name:"UnknownArtifactError",message:e+" not known"}}return"you have created "+e+" "+arguments[1]},"export":function(){var e=arguments[0];switch(e){case"jpeg":console.log("jpeg not yet supported");break;case"png":var n=document.createElement("canvas");n.width=1e3,n.height=800;var r=$("<div>").append($("svg").clone()).html();t(n,r);var i=n.toDataURL();window.open(i,"mywindow");break;default:throw{name:"FormatNotSupportedException",message:e+" is not supported"}}},set:function(){if(this.contextPath.length<4)throw{name:"ContextPathException",message:"no value can be set at this context"};if(this.contextPath.length===4){if(arguments[0]!=="flavor")throw{name:"ArgumentNotKnown",message:arguments[0]+" is not a valid property"};this.diagramModel.set(this.contextPath,arguments[0],arguments[1])}else if(this.contextPath.length===6)if(this.contextPath[4]==="property")if(arguments[0]==="visibility")this.diagramModel.set(this.contextPath,arguments[0],arguments[1]);else{if(arguments[0]!=="type")throw{name:"ArgumentNotKnown",message:arguments[0]+" is not a valid property"};this.diagramModel.set(this.contextPath,arguments[0],arguments[1])}else if(this.contextPath[4]==="method")if(arguments[0]==="visibility")this.diagramModel.set(this.contextPath,arguments[0],arguments[1]);else{if(arguments[0]!=="returnType")throw{name:"ArgumentNotKnown",message:arguments[0]+" is not a valid property"};this.diagramModel.set(this.contextPath,arguments[0],arguments[1])}},con:function(){return this.contextPath.join(" ")},show:function(){var e=this.diagramModel.toJSON();return"<pre>"+e+"</pre>"},load:function(e){if(!this.diagramModel.currentDiagram){var t=$.Deferred(),n=this;return $.when($.getJSON("/diagrams/"+e+".json",function(r){n.componentFactory.createDiagram(e,r),t.resolve({message:"created diagram "+e})})).fail(function(){t.resolve({message:"no such diagram"})}),t}throw{name:"CoexistingDiagramException ",message:"You already have an existing diagram. Delete this first before creating a new diagram"}},help:function(){var e=$.Deferred(),t=arguments[0],n="main";return $.when($.ajax({url:"/help/"+n+".html",dataType:"html"})).then(function(t){e.resolve({message:t})}),e}})}),define("eventNode",[],function(){var e=function(t,n,r){this.listeners={},this.name=n,r&&(this.parent=r);if(typeof t=="object"){this.children={};for(var i in t)this.children[i]=new e(t[i],i,this)}else this.value=t};return e.prototype.unwrap=function(){var e={};for(var t in this.children)this.children[t].value?e[t]=this.children[t].value:e[t]=this.children[t].unwrap();return e},e.prototype.on=function(e,t,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push([t,n])},e.prototype.createChild=function(t,n){return this.children[t]=new e(n,t,this),this.fire("create",this.children[t]),this.children[t]},e.prototype.deleteChild=function(e){var t=this.children[e];return delete this.children[e],this.fire("delete",t),t},e.prototype.broadcast=function(e){var t;this.listeners&&(t=this.listeners[e]);if(t){var n=Array.prototype.slice.call(arguments,1);for(var r=0;r<t.length;r++)t[r][0].apply(t[r][1],n)}for(var i in this.children)this.children[i].broadcast.apply(this.children[i],arguments)},e.prototype.fire=function(e){var t;this.listeners&&(t=this.listeners[e]);if(t){var n=Array.prototype.slice.call(arguments,1);for(var r=0;r<t.length;r++)t[r][0].apply(t[r][1],n)}this.parent&&this.parent.fire.apply(this.parent,arguments)},e.prototype.set=function(e,t){var n="";if(this.value===undefined)throw{name:"NonPrimitiveNodeException",message:e+" "+n};n=this.value,this.value=e,t||this.fire("change",e,n)},e}),define("diagram/types/typeModel",["BaseType"],function(e){return e.extend({initialize:function(e){this.diagramModel=e.diagramModel,this.model=e.model,this.listeners={},this.model.on("change",this.changeHandler,this),this.model.on("create",this.changeHandler,this),this.model.on("deleteProperty",this.changeHandler,this),this.model.on("deleteMethod",this.changeHandler,this),this.model.on("deleteArgs",this.changeHandler,this)},on:function(e,t,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push([t,n])},changeHandler:function(){this.fire("update")},fire:function(e){var t=this.listeners[e];if(t){var n=Array.prototype.slice.call(arguments,1);for(var r=0;r<t.length;r++)t[r][0].apply(t[r][1],n)}},getName:function(){return this.model.name},fireReceiveClickEvent:function(e){this.model.fire("receiveRequest",e)},setCoods:function(e,t){this.model.children.xCood.set(e),this.model.children.yCood.set(t),this.fire("move")},setWidth:function(e){var t=this.model.children.width.value;this.model.children.width.set(e,!0),t!==e&&this.fire("changeWidth")},setHeight:function(e){var t=this.model.children.height.value;this.model.children.height.set(e,!0),t!==e&&this.fire("changeHeight")},getHeight:function(){return this.model.children.height.value},getWidth:function(){return this.model.children.width.value},getFlavor:function(){return this.model.children.flavor.value},getXCood:function(){return this.model.children.xCood.value},getYCood:function(){return this.model.children.yCood.value},getMethods:function(){var e=this.model.unwrap().methods;return e},getProperties:function(){return this.model.unwrap().properties}})}),define("diagram/connectors/horizontalConnectorModel",["BaseType"],function(e){return e.extend({initialize:function(e){this.model=e.model,this.lineStyles=["dashed","solid"],this.currentLineStyleIndex=0},fire:function(e,t,n){this.model.fire(e,t,n)},getLeftArrow:function(){return this.model.children.nodes.children.left},getProximalNode:function(){return this.model.children.nodes.children.proximal},getDistalNode:function(){return this.model.children.nodes.children.distal},getRightArrow:function(){return this.model.children.nodes.children.right},alternateLineStyle:function(){this.setLineStyle(this.lineStyles[this.currentLineStyleIndex]),this.currentLineStyleIndex=(this.currentLineStyleIndex+1)%this.lineStyles.length},setLineStyle:function(e){this.model.children.lineStyle.set(e)},getLineStyle:function(){return this.model.children.lineStyle.value}})}),define("diagram/boxNodeMediator",["BaseType"],function(e){return e.extend({initialize:function(e){this.nodeMediator=e.nodeMediator,this.typeController=e.typeController,this.nodeOrientation=e.nodeOrientation,e.dontMove||this._moveNodeOnToBox(),this.typeController.addAttachedNodeMediator(this),this.nodeMediator.addBoxNodeMediator(this,this.nodeOrientation),this.typeController.model.on("changeHeight",this.repositionNode,this),this.typeController.model.on("changeWidth",this.repositionNode,this)},destroy:function(){this.typeController.unAttachNodeMediator(this)},moveNode:function(e,t){this.nodeMediator.updateUsingDifference(this.nodeOrientation,e,t)},repositionNode:function(){this._moveNodeOnToBox()},destroyFromType:function(){this.nodeMediator.removeBoxNodeMediator(this.nodeOrientation)}})}),define("diagram/boxHorizontalNodeMediator",["diagram/boxNodeMediator"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},getBoxRightLimit:function(){return this.typeController.getRightXLimit()},getBoxLeftLimit:function(){return this.typeController.getLeftXLimit()},calculateNodeXCood:function(e){return e>this.getBoxRightLimit()?this.getBoxRightLimit():this.getBoxLeftLimit()},getDistalNodeCoods:function(e,t,n,r){var i=this.typeController.getTopYLimit(),s=this.typeController.getBottomYLimit();if(t<i||t>s)t=r;return{x:e,y:t}},getProximalNodeCoods:function(e,t,n,r){var i=this.typeController.getTopYLimit(),s=this.typeController.getBottomYLimit();if(t<i||t>s)t=r;return{x:e,y:t}},getRightNodeCoods:function(e,t,n,r){return this._getNodeCoods(e,t,n,r)},getLeftNodeCoods:function(e,t,n,r){return this._getNodeCoods(e,t,n,r)},_getNodeCoods:function(e,t,n,r){var i=this.typeController.getTopYLimit(),s=this.typeController.getBottomYLimit();if(t<i||t>s)t=r;return{x:n,y:t}},_moveNodeOnToBox:function(){var e=this.nodeMediator.proximalNodeModel.getXCood(),t=this.calculateNodeXCood(e),n=this.typeController.getTopYLimit(),r=this.typeController.getBottomYLimit(),i=(n+r)/2;this.nodeMediator.update(this.nodeOrientation,t,i,!0)}})}),define("diagram/boxVerticalNodeMediator",["diagram/boxNodeMediator"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},getBoxTopLimit:function(){return this.typeController.getTopYLimit()},getBoxBottomLimit:function(){return this.typeController.getBottomYLimit()},getSecondBottomNodeCoods:function(e,t,n,r){var i=this.typeController.getLeftXLimit(),s=this.typeController.getRightXLimit();if(e<i||e>s)e=n;return{x:e,y:t}},calculateNodeYCood:function(e){return e<this.getBoxTopLimit()?this.getBoxTopLimit():this.getBoxBottomLimit()},getSecondTopNodeCoods:function(e,t,n,r){var i=this.typeController.getLeftXLimit(),s=this.typeController.getRightXLimit();if(e<i||e>s)e=n;return{x:e,y:t}},getBottomNodeCoods:function(e,t,n,r){var i=this.typeController.getRightXLimit(),s=this.typeController.getLeftXLimit();if(e<s||e>i)e=n;return{x:e,y:r}},getTopNodeCoods:function(e,t,n,r){var i=this.typeController.getRightXLimit(),s=this.typeController.getLeftXLimit();if(e<s||e>i)e=n;return{x:e,y:r}},_getNodeCoods:function(e,t,n,r){},_moveNodeOnToBox:function(){var e=this.nodeMediator.secondTopNodeModel.getYCood(),t=this.calculateNodeYCood(e);console.log("_moveNodeOnToBox y ",t);var n=this.typeController.getRightXLimit(),r=this.typeController.getLeftXLimit(),i=(n+r)/2;this.nodeMediator.update(this.nodeOrientation,i,t,!0)}})}),define("diagram/connectors/verticalConnectorModel",["BaseType"],function(e){return e.extend({initialize:function(e){this.model=e.model,this.lineStyles=["dashed","solid"],this.currentLineStyleIndex=0},fire:function(e,t,n){this.model.fire(e,t,n)},getTopArrow:function(){return this.model.children.nodes.children.top},getSecondTopNode:function(){return this.model.children.nodes.children.secondTop},getSecondBottomNode:function(){return this.model.children.nodes.children.secondBottom},getBottomArrow:function(){return this.model.children.nodes.children.bottom},alternateLineStyle:function(){this.setLineStyle(this.lineStyles[this.currentLineStyleIndex]),this.currentLineStyleIndex=(this.currentLineStyleIndex+1)%this.lineStyles.length},setLineStyle:function(e){this.model.children.lineStyle.set(e)},getLineStyle:function(){return this.model.children.lineStyle.value}})}),define("utility/idGenerator",[],function(){var e=1,t="abc";return{nextId:function(){var n=e++;return t+n}}}),define("diagram/diagramModel2",["BaseType","eventNode","diagram/types/typeModel","diagram/connectors/horizontalConnectorModel","diagram/boxHorizontalNodeMediator","diagram/boxVerticalNodeMediator","diagram/connectors/verticalConnectorModel","utility/idGenerator"],function(e,t,n,r,i,s,o,u){return e.extend({initialize:function(){this.currentDiagram=null,this.model=new t({diagrams:{}}),this.model.on("attachRequest",function(e,t){this.requestedNode={nodeMediator:e,nodeOrientation:t}}),this.model.on("receiveRequest",function(e){if(this.requestedNode){var t=this.requestedNode.nodeOrientation;t==="left"||t==="right"?new i({nodeMediator:this.requestedNode.nodeMediator,nodeOrientation:this.requestedNode.nodeOrientation,typeController:e}):new s({nodeMediator:this.requestedNode.nodeMediator,nodeOrientation:this.requestedNode.nodeOrientation,typeController:e}),this.requestedNode=null}})},toJSON:function(){return JSON.stringify(this.model.unwrap(),null,2)},createDiagram:function(e,t){if(this.currentDiagram)throw{name:"CoexistingDiagramException",message:"You already have already created a diagram"};t?this.currentDiagram=this.model.children.diagrams.createChild(e,t):this.currentDiagram=this.model.children.diagrams.createChild(e,{types:{},connectors:{}})},deleteDiagram:function(e){debugger;this.model.children.diagrams.deleteChild(e),this.currentDiagram=null},set:function(e,t,n){var r={diagram:"diagrams",type:"types",property:"properties",method:"methods"},i=this.model;for(var s=1;s<=e.length;s+=2){var o=r[e[s-1]];i=i.children[o].children[e[s]]}i.children[t].set(n)},createVerticalConnector:function(e){var t=u.nextId(),n=this.model.children.diagrams.children[e].children.connectors.createChild(t,{orientation:"vertical",nodes:{top:{xCood:300,yCood:100,attached:!1,attachedBox:"",arrow:{style:"blackConnectArrow",direction:"top"}},secondTop:{xCood:300,yCood:200,attached:!1,attachedBox:""},secondBottom:{xCood:400,yCood:200,attached:!1,attachedBox:""},bottom:{xCood:400,yCood:300,attached:!1,attachedBox:"",arrow:{style:"whiteArrow",direction:"bottom"}}},lineStyle:"solid"});return new o({model:n})},createHorizontalConnector:function(e){var t=u.nextId(),n=this.model.children.diagrams.children[e].children.connectors.createChild(t,{orientation:"horizontal",nodes:{left:{xCood:100,yCood:100,attached:!1,attachedBox:"",arrow:{style:"blackConnectArrow",direction:"left"}},proximal:{xCood:200,yCood:100,attached:!1,attachedBox:""},distal:{xCood:200,yCood:300,attached:!1,attachedBox:""},right:{xCood:400,yCood:300,attached:!1,attachedBox:"",arrow:{style:"whiteArrow",direction:"right"}}},lineStyle:"solid"});return new r({model:n})},createType:function(e,t){return this.model.children.diagrams.children[e].children.types.createChild(t,{properties:{testProp:{name:"testProp",visibility:"private",type:"String"}},flavor:"interface",methods:{},xCood:700,yCood:400,width:10,height:10})},createArg:function(e,t,n,r,i){this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n].children.args.createChild(r,{name:r,type:i})},deleteArg:function(e,t,n,r){return this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n].children.args.deleteChild(r)},getTypeName:function(e,t){return this.model.children.diagrams.children[e].children.types.children[t].name},getConnectors:function(e){return this.model.children.diagrams.children[e].children.connectors.children},createProperty:function(e,t,n){this.model.children.diagrams.children[e].children.types.children[t].children.properties.createChild(n,{name:n,visibility:"private",type:"Object"})},getProperty:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.properties.children[n]},createMethod:function(e,t,n){this.model.children.diagrams.children[e].children.types.children[t].children.methods.createChild(n,{name:n,visibility:"public",returnType:"void",args:[]})},checkPropertyExists:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.properties.children[n]!==undefined?!0:!1},checkMethodExists:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n]!==undefined?!0:!1},checkArgExists:function(e,t,n,r){return this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n].children.args.children[r]!==undefined?!0:!1},checkTypeExists:function(e,t){return this.model.children.diagrams.children[e].children.types.children[t]!==undefined?!0:!1},checkConnectorExists:function(e,t){return this.model.children.diagrams.children[e].children.connectors.children[t]!==undefined?!0:!1},checkDiagramExists:function(e){return this.model.children.diagrams.children[e]!==undefined?!0:!1},getMethod:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n]},deleteMethod:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.methods.deleteChild(n)},deleteProperty:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.properties.deleteChild(n)},setMethodVisibility:function(e,t,n,r){this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n].children.visibility.set(r)},getMethodVisibility:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.methods.children[n].children.visibility.value},getPropertyVisibility:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.properties.children[n].children.visibility.value},getPropertyType:function(e,t,n){return this.model.children.diagrams.children[e].children.types.children[t].children.properties.children[n].children.type.value}})}),define("utility/svg",["raphael","jquery"],function(e,t){var n=e(0,0,1200,1e3);return n}),define("utility/typeBox",["utility/svg","BaseType","underscore"],function(e,t,n){return t.extend({paddingTop:10,lineHeight:15,paddingLeft:5,paddingRight:5,paddingBottom:10,separatorYOffset:7,backgroundColor:"#ffffce",outlineColor:"#666",nameTextYOffset:null,propertiesYOffset:null,methodsYOffset:null,svgMethodTextArray:null,svgPropertyTextArray:null,initialize:function(t){this.model=t.model;var n=this.model.getXCood(),r=this.model.getYCood(),i=this.model.getName();this._calculateGeometry(),this.typeBox=e.rect(n,r,500,500),this.svgMethodTextArray=[],this.svgPropertyTextArray=[],this.typeBox.attr("fill",this.backgroundColor),this.typeBox.attr("stroke",this.outlineColor);if(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")this.flavorText=this.createFlavorText(this.model.getFlavor());this.nameText=this.createNameText(i),this.createProperties(),this.createMethods();var s=this._calculateWidth(),o=this._calculateHeight();this.rect=e.rect(n,r,500,500),this.rect.attr({fill:"red",opacity:0}),this.rect.attr({width:s,height:o}),this.typeBox.attr({width:s,height:o})},destroy:function(){this.removeContents(),this.typeBox.remove(),this.rect.remove()},_calculateWidth:function(){var e=0,t=this.svgMethodTextArray.concat(this.svgPropertyTextArray,this.nameText);return(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")&&t.push(this.flavorText),n.each(t,function(t){var n=t.getBBox().width;e=n>e?n:e}),e=e+this.paddingLeft+this.paddingRight,this.model.setWidth(e),e},_calculateHeight:function(){var e=n.size(this.model.getMethods())*this.lineHeight+this.methodsYOffset+this.paddingBottom;return this.model.setHeight(e),e},_calculateGeometry:function(){var e=0;if(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")e=this.lineHeight;this.nameTextYOffset=this.paddingTop+e,this.propertiesYOffset=this.nameTextYOffset+this.lineHeight+this.separatorYOffset;var t=n.size(this.model.getProperties());this.methodsYOffset=this.propertiesYOffset+this.separatorYOffset+t*this.lineHeight},createNameText:function(t){var n=this.model.getXCood(),r=this.model.getYCood(),i=e.text(this.paddingLeft+n,r+this.nameTextYOffset,t);return i.attr({"text-anchor":"start"}),i},createProperties:function(){var t=this.formatProperties(this.model.getProperties()),r,i=this.model.getXCood(),s=this.model.getYCood();n.each(t,function(t,n){r=n*this.lineHeight;var o=e.text(i+this.paddingLeft,s+this.propertiesYOffset+r,t);o.attr({"text-anchor":"start"}),this.svgPropertyTextArray.push(o)},this)},createMethods:function(){var t=this.formatMethods(this.model.getMethods()),r,i=this.model.getXCood(),s=this.model.getYCood();n.each(t,function(t,n){r=n*this.lineHeight;var o=e.text(i+this.paddingLeft,s+this.methodsYOffset+r,t);o.attr({"text-anchor":"start"}),this.svgMethodTextArray.push(o)},this)},moveMethods:function(e,t){var r;n.each(this.svgMethodTextArray,function(n,i){r=i*this.lineHeight,n.attr({x:e+this.paddingLeft}),n.attr({y:t+this.methodsYOffset+r})},this)},removeContents:function(){this.nameText.remove(),this.flavorText&&this.flavorText.remove();var e=this.svgMethodTextArray.concat(this.svgPropertyTextArray);n.each(e,function(e){e.remove()}),this.svgMethodTextArray=[],this.svgPropertyTextArray=[]},moveProperties:function(){var e=this.model.getXCood(),t=this.model.getYCood(),r;n.each(this.svgPropertyTextArray,function(n,i){r=i*this.lineHeight,n.attr({x:e+this.paddingLeft}),n.attr({y:t+this.propertiesYOffset+r})},this)},moveNameText:function(){var e=this.model.getXCood(),t=this.model.getYCood();this.nameText.attr({x:this.paddingLeft+e,y:t+this.nameTextYOffset})},createFlavorText:function(t){var n=this.model.getXCood(),r=this.model.getYCood();t="<<"+t+">>";var i=e.text(this.paddingLeft+n,r+this.paddingTop,t);return i.attr({"text-anchor":"start"}),i},moveFlavorText:function(e,t){this.flavorText.attr({x:this.paddingLeft+e,y:t+this.paddingTop})},move:function(){var e=this.model.getXCood(),t=this.model.getYCood();this.rect.attr({x:e}),this.rect.attr({y:t}),this.typeBox.attr({x:e}),this.typeBox.attr({y:t}),this.moveNameText(e,t),(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")&&this.moveFlavorText(e,t),this.moveMethods(e,t),this.moveProperties(e,t)},update:function(){this.removeContents(),this._calculateGeometry(),this.createProperties(),this.createMethods();if(this.model.getFlavor()==="interface"||this.model.getFlavor()==="abstract")this.flavorText=this.createFlavorText(this.model.getFlavor());this.nameText=this.createNameText(this.model.getName());var e=this._calculateWidth(),t=this._calculateHeight();this.rect.attr({width:e,height:t}),this.typeBox.attr({width:e,height:t})},formatProperties:function(e){return n.map(e,function(e){var t="";return t+=this._convertVisibility(e.visibility),t+=e.name,t+=":",t+=e.type,t},this)},formatMethods:function(e){function t(e){var t="";return n.each(e,function(e){t+=e.name+":"+e.type+","}),t.substring(0,t.length-1)}return n.map(e,function(e){var n="",r;return r=t(e.args),n+=this._convertVisibility(e.visibility),n+=e.name,n+="("+r+"):",n+=e.returnType,n},this)},_convertVisibility:function(e){switch(e){case"private":return"-";case"protected":return"#";case"public":return"+";default:return"-"}}})}),define("diagram/types/typeView",["BaseType","utility/typeBox"],function(e,t){return e.extend({initialize:function(e){this.model=e.model,this.model.on("move",this.move,this),this.model.on("update",this.update,this),this.model.on("delete",this.destroy,this),this.box=new t({model:this.model,x:100,y:200,width:100,height:50})},destroy:function(){this.box.destroy()},getElement:function(){return this.box},move:function(){this.box.move()},update:function(){this.box&&this.box.update()}})}),define("diagram/types/typeController",["BaseType","utility/typeBox","underscore"],function(e,t,n){return e.extend({initialize:function(e){n.bindAll(this,"_onMove","_onStart","_onEnd"),this.attachedNodesMediators=[],this.startX=null,this.startY=null,this.model=e.model,this.view=e.view,this.box=this.view.box.rect,this.box.drag(this._onMove,this._onStart,this._onEnd);var t=this;this.box.click(function(){t.model.fireReceiveClickEvent(t)})},destroy:function(){this.removeAttachedMediators(),this.view.destroy()},getTopYLimit:function(){return this.model.getYCood()},getBottomYLimit:function(){return this.model.getYCood()+this.model.getHeight()},getLeftXLimit:function(){return this.model.getXCood()},getRightXLimit:function(){return this.model.getXCood()+this.model.getWidth()},_onMove:function(e,t){var r=this.startX+e,i=this.startY+t,s=this.model.getXCood(),o=this.model.getYCood(),u=r-s,a=i-o;this.model.setCoods(r,i),n.each(this.attachedNodesMediators,function(e){e.moveNode(u,a)})},_onStart:function(){this.startX=parseInt(this.box.attr("x")),this.startY=parseInt(this.box.attr("y"))},_onEnd:function(){this.startX=null,this.startY=null},addAttachedNodeMediator:function(e){this.attachedNodesMediators.push(e)},removeAttachedMediators:function(){var e=this.attachedNodesMediators.length;for(var t=0;t<e;t++)this.attachedNodesMediators[0].destroyFromType()},unAttachNodeMediator:function(e){n.each(this.attachedNodesMediators,function(t,n){t===e&&this.attachedNodesMediators.splice(n,1)},this)}})}),define("utility/svgUtilities",["utility/svg"],function(e){return{buildPath:function(e,t){var n="M"+e[0].x+" "+e[0].y+"L";for(var r=1;r<e.length;r++)n+=e[r].x+" ",n+=e[r].y+" ";return t&&(n+="Z"),n},setShapeOpacity:function(e,t){var n=t?1:0;e.attr("opacity",n)},nullObject:function(){return{attr:function(){},remove:function(){}}},createPath:function(t,n){var r=e.path(t);return n&&r.attr({fill:n}),r.attr({stroke:"black"}),r},resetPath:function(e,t){e.attr({path:t})},createCircle:function(t,n){var r=e.circle(t,n,10);return r},resetRectangle:function(e,t,n){e.attr({x:t,y:n})},createText:function(t){e.text(100,100,t)},resetLine:function(e,t){t==="dashed"?e.attr("stroke-dasharray","-"):e.attr({"stroke-dasharray":""})}}}),define("diagram/connectors/nodes/arrow",["BaseType","jquery","utility/svgUtilities"],function(e,t,n){return e.extend({initialize:function(e){this.model=e.model,this._createElement()},move:function(){var e=this._getStyle();if(e==="whiteArrow"){var t=this._buildPath("arrow",!0);n.resetPath(this.element,t)}else if(e==="blackDiamond"){var t=this._buildPath("diamond",!0);n.resetPath(this.element,t)}else if(e==="blackConnectArrow"){var t=this._buildPath("connectArrow",!1);n.resetPath(this.element,t)}else if(e==="whiteDiamond"){var t=this._buildPath("diamond",!0);n.resetPath(this.element,t)}},changeArrowHead:function(){this.element.remove(),this._createElement()},destroy:function(){this.element.remove()},_createElement:function(){var e=this._getStyle();if(e==="whiteArrow"){var t=this._buildPath("arrow",!0);this.element=n.createPath(t,"white")}else if(e==="blackDiamond"){var t=this._buildPath("diamond",!0);this.element=n.createPath(t,"black")}else if(e==="whiteDiamond"){var t=this._buildPath("diamond",!0);this.element=n.createPath(t,"white")}else if(e==="blackConnectArrow"){var t=this._buildPath("connectArrow",!1);this.element=n.createPath(t)}else this.element=n.nullObject()},_buildPath:function(e,t){var r=this._getDirection(),i=this._createPointsArray(e,r);return n.buildPath(i,t)},_getStyle:function(){return this.model.getStyle()},_getDirection:function(){return this.model.getDirection()},_createPointsArray:function(e,t){var n=this.model.getXCood(),r=this.model.getYCood();if(e==="arrow")switch(t){case"top":return[this._getPoint(n,r),this._getPoint(n+10,r+10),this._getPoint(n-10,r+10)];case"bottom":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n-10,r-10)];case"left":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n+10,r+10)];case"right":return[this._getPoint(n,r),this._getPoint(n-10,r+10),this._getPoint(n-10,r-10)]}else if(e==="connectArrow")switch(t){case"top":return[this._getPoint(n+10,r+10),this._getPoint(n,r),this._getPoint(n-10,r+10)];case"bottom":return[this._getPoint(n+10,r-10),this._getPoint(n,r),this._getPoint(n-10,r-10)];case"left":return[this._getPoint(n+10,r-10),this._getPoint(n,r),this._getPoint(n+10,r+10)];case"right":return[this._getPoint(n-10,r+10),this._getPoint(n,r),this._getPoint(n-10,r-10)]}else if(e==="diamond")switch(t){case"top":return[this._getPoint(n,r),this._getPoint(n+10,r+10),this._getPoint(n,r+20),this._getPoint(n-10,r+10)];case"bottom":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n,r-20),this._getPoint(n-10,r-10)];case"left":return[this._getPoint(n,r),this._getPoint(n+10,r-10),this._getPoint(n+20,r),this._getPoint(n+10,r+10)];case"right":return[this._getPoint(n,r),this._getPoint(n-10,r+10),this._getPoint(n-20,r),this._getPoint(n-10,r-10)]}},_getPoint:function(e,t){return{x:e,y:t}}})}),define("diagram/connectors/nodes/nodeModel",["BaseType"],function(e){return e.extend({initialize:function(e){this.model=e.model,this.arrowHeadStyles=["whiteArrow","whiteDiamond","blackDiamond","blackConnectArrow","none"],this.currentArrowHeadIndex=0},destroy:function(){this.model.fire("destroy")},getXCood:function(){return parseInt(this.model.children.xCood.value,10)},setXCood:function(e){this.model.children.xCood.set(e)},setYCood:function(e){this.model.children.yCood.set(e)},getYCood:function(){return parseInt(this.model.children.yCood.value,10)},fire:function(e,t,n){this.model.fire("attachRequest",t,n)},onXCood:function(e,t,n){this.model.children.xCood.on(e,t,n)},onYCood:function(e,t,n){this.model.children.yCood.on(e,t,n)},on:function(e,t,n){this.model.on(e,t,n)},getStyle:function(){return this.model.children.arrow.children.style.value},switchArrowHead:function(){var e=this.arrowHeadStyles[this.currentArrowHeadIndex];this.model.children.arrow.children.style.set(e,!0),this.model.fire("switchArrowHead"),this.currentArrowHeadIndex=(this.currentArrowHeadIndex+1)%this.arrowHeadStyles.length},getDirection:function(){return this.model.children.arrow.children.direction.value},setArrowDirection:function(e){this.model.children.arrow.children.direction.set(e)},isAttached:function(){return this.model.children.attached.value},setAttached:function(e){this.model.children.attached.set(e)},isArrowNode:function(){return this.model.children.arrow?!0:!1},broadcast:function(e){this.model.broadcast(e)}})}),define("diagram/connectors/nodes/arrowView",["BaseType","utility/svg","diagram/connectors/nodes/arrow","diagram/connectors/nodes/nodeModel"],function(e,t,n,r){return e.extend({initialize:function(e){this.model=e.model;var r=this.model.getXCood(),i=this.model.getYCood();this.node=t.circle(r,i,10),this.node.attr({fill:"green",opacity:0,stroke:0}),this.model.onXCood("change",this.updateX,this),this.model.onYCood("change",this.updateY,this),this.model.on("switchArrowHead",this.switchArrowHead,this),this.model.on("destroy",this.destroy,this),this.model.isArrowNode()&&(this.arrow=new n({model:this.model})),this.node.toFront()},destroy:function(){this.model.isArrowNode()&&this.arrow.destroy(),this.node.remove()},switchArrowHead:function(){this.arrow.changeArrowHead(),this.node.toFront()},getSvgNode:function(){return this.node},updateX:function(){var e=this.model.getXCood();this.node.attr({cx:e}),this.arrow&&this.arrow.move(),this.node.toFront()},updateY:function(){var e=this.model.getYCood();this.node.attr({cy:e}),this.arrow&&this.arrow.move(),this.node.toFront()}})}),define("diagram/connectors/nodes/arrowController",["BaseType","underscore","diagram/connectors/nodes/nodeModel"],function(e,t,n){return e.extend({initialize:function(e){t.bindAll(this,"_onMove","_onStart","_onEnd"),this.view=e.view,this.mediator=e.mediator,this.orientation=e.orientation,this.model=e.model,this.svgNode=this.view.getSvgNode(),this.startX=null,this.startY=null,this.svgNode.drag(this._onMove,this._onStart,this._onEnd);var n=this;(this.orientation==="left"||this.orientation==="right"||this.orientation==="top"||this.orientation==="bottom")&&this.svgNode.click(function(e){!e.ctrlKey&&e.shiftKey?n._isAttached()?n.mediator.removeBoxNodeMediator(n.orientation):n.mediator.fireAttachRequest(n.orientation):e.ctrlKey&&e.shiftKey&&n.model.switchArrowHead()}),this.svgNode.click(function(e){e.ctrlKey&&!e.shiftKey&&n.mediator.changeLineStyle()})},_isAttached:function(){return this.model.isAttached()},_onMove:function(e,t){var n=this.startX+e,r=this.startY+t;this.mediator.update(this.orientation,n,r)},_onStart:function(){this.startX=parseInt(this.svgNode.attr("cx")),this.startY=parseInt(this.svgNode.attr("cy"))},_onEnd:function(){this.startX=null,this.startY=null}})}),define("diagram/connectors/nodes/horizontalNodesMediator",["BaseType","diagram/connectors/nodes/nodeModel"],function(e,t){return e.extend({initialize:function(e){this.leftArrowModel=e.leftArrowModel,this.proximalNodeModel=e.proximalNodeModel,this.distalNodeModel=e.distalNodeModel,this.rightArrowModel=e.rightArrowModel,this.connectorModel=e.connectorModel},addBoxNodeMediator:function(e,t){if(t==="left")this._attachTypeBoxToLeftNode(e);else{if(t!=="right")throw{name:"IncorrectNodeMediatorAttachmentError"};this._attachTypeBoxToRightNode(e)}},changeLineStyle:function(){this.connectorModel.alternateLineStyle()},removeBoxNodeMediator:function(e){e==="left"?(this.leftArrowModel.setAttached(!1),this.leftArrowModel.model.children.attachedBox.set(null),this.leftNodeTypeBoxMediator.destroy(),this.leftNodeTypeBoxMediator=null):(this.rightArrowModel.setAttached(!1),this.rightArrowModel.model.children.attachedBox.set(null),this.rightNodeTypeBoxMediator.destroy(),this.rightNodeTypeBoxMediator=null)},destroy:function(){this.detachAll(),this.leftArrowModel.destroy(),this.proximalNodeModel.destroy(),this.distalNodeModel.destroy(),this.rightArrowModel.destroy()},detachAll:function(){this.leftNodeTypeBoxMediator&&this.removeBoxNodeMediator("left"),this.rightNodeTypeBoxMediator&&this.removeBoxNodeMediator("right")},_attachTypeBoxToRightNode:function(e){this.rightArrowModel.setAttached(!0);var t=e.typeController.model.model.name;this.rightArrowModel.model.children.attachedBox.set(t),this.rightNodeTypeBoxMediator=e},_attachTypeBoxToLeftNode:function(e){this.leftArrowModel.setAttached(!0);var t=e.typeController.model.model.name;this.leftArrowModel.model.children.attachedBox.set(t),this.leftNodeTypeBoxMediator=e},update:function(e,t,n,r){switch(e){case"left":this.updateLeftArrow(t,n,r);break;case"proximal":this.updateProximalNode(t,n);break;case"distal":this.updateDistalNode(t,n);break;case"right":this.updateRightArrow(t,n,r)}},updateUsingDifference:function(e,t,n){var r,i;switch(e){case"left":r=this.leftArrowModel.getXCood()+t,i=this.leftArrowModel.getYCood()+n;var s=this.proximalNodeModel.getXCood();this.leftArrowModel.setXCood(this.leftNodeTypeBoxMediator.calculateNodeXCood(s)),this._setLeftArrowDirection(),this.leftArrowModel.setYCood(i),this.proximalNodeModel.setYCood(i);break;case"right":r=this.rightArrowModel.getXCood()+t,i=this.rightArrowModel.getYCood()+n;var o=this.distalNodeModel.getXCood();this.rightArrowModel.setXCood(this.rightNodeTypeBoxMediator.calculateNodeXCood(o)),this.setRightArrowDirection(),this.rightArrowModel.setYCood(i),this.distalNodeModel.setYCood(i)}},fireAttachRequest:function(e){this.connectorModel.fire("attachRequest",this,e)},updateLeftArrow:function(e,t,n){if(this._leftArrowAttached()){var r=this.leftArrowModel.getXCood(),i=this.leftArrowModel.getYCood();if(!n){var s=this.leftNodeTypeBoxMediator.getLeftNodeCoods(e,t,r,i);e=s.x,t=s.y}}this.leftArrowModel.setXCood(e),this.leftArrowModel.setYCood(t),this.proximalNodeModel.setYCood(t),this._setLeftArrowDirection()},updateProximalNode:function(e,t){this._rightArrowAttached()&&this.rightArrowModel.setXCood(this.rightNodeTypeBoxMediator.calculateNodeXCood(e));if(this._leftArrowAttached()){var n=this.proximalNodeModel.getXCood(),r=this.proximalNodeModel.getYCood(),i=this.leftNodeTypeBoxMediator.getProximalNodeCoods(e,t,n,r);e=i.x,t=i.y,this.leftArrowModel.setXCood(this.leftNodeTypeBoxMediator.calculateNodeXCood(e))}this.setRightArrowDirection(),this._setLeftArrowDirection(),this.proximalNodeModel.setXCood(e),this.proximalNodeModel.setYCood(t),this.leftArrowModel.setYCood(t),this.distalNodeModel.setXCood(e)},updateDistalNode:function(e,t){if(this._rightArrowAttached()){var n=this.distalNodeModel.getXCood(),r=this.distalNodeModel.getYCood(),i=this.rightNodeTypeBoxMediator.getDistalNodeCoods(e,t,n,r);e=i.x,t=i.y,this.rightArrowModel.setXCood(this.rightNodeTypeBoxMediator.calculateNodeXCood(e))}this._leftArrowAttached()&&this.leftArrowModel.setXCood(this.leftNodeTypeBoxMediator.calculateNodeXCood(e)),this.setRightArrowDirection(),this._setLeftArrowDirection(),this.distalNodeModel.setXCood(e),this.distalNodeModel.setYCood(t),this.proximalNodeModel.setXCood(e),this.rightArrowModel.setYCood(t)},updateRightArrow:function(e,t,n){if(this._rightArrowAttached()&&!n){var r=this.rightArrowModel.getXCood(),i=this.rightArrowModel.getYCood(),s=this.rightNodeTypeBoxMediator.getRightNodeCoods(e,t,r,i);e=s.x,t=s.y}this.rightArrowModel.setXCood(e),this.rightArrowModel.setYCood(t),this.distalNodeModel.setYCood(t),this.setRightArrowDirection()},setRightArrowDirection:function(){this.rightArrowModel.getXCood()<this.proximalNodeModel.getXCood()?this.rightArrowModel.setArrowDirection("left"):this.rightArrowModel.setArrowDirection("right"),this.rightArrowModel.broadcast("change")},_setLeftArrowDirection:function(){this.leftArrowModel.getXCood()<this.proximalNodeModel.getXCood()?this.leftArrowModel.setArrowDirection("left"):this.leftArrowModel.setArrowDirection("right"),this.leftArrowModel.broadcast("change")},_rightArrowAttached:function(){return this.rightArrowModel.isAttached()},_leftArrowAttached:function(){return this.leftArrowModel.isAttached()}})}),define("diagram/connectors/lines/lineView",["BaseType","utility/svgUtilities"],function(e,t){return e.extend({initialize:function(e){this.modelA=e.modelA,this.modelB=e.modelB,this.connectorModel=e.connectorModel,this.line=t.createPath(this.buildPath(),"red"),this.connectorModel.model.on("change",function(){this.updateLine()},this),this.modelA.on("destroy",this.destroy,this)},destroy:function(){this.line.remove()},updateLine:function(){t.resetPath(this.line,this.buildPath()),t.resetLine(this.line,this.connectorModel.getLineStyle())},buildPath:function(){var e=this.modelA.getXCood(),n=this.modelA.getYCood(),r=this.modelB.getXCood(),i=this.modelB.getYCood();return t.buildPath([{x:e,y:n},{x:r,y:i}],!1)}})}),define("diagram/connectors/horizontalConnectorFactory",["BaseType","diagram/connectors/nodes/arrowView","diagram/connectors/nodes/arrowController","diagram/connectors/nodes/horizontalNodesMediator","diagram/connectors/lines/lineView","diagram/connectors/nodes/nodeModel"],function(e,t,n,r,i,s){return{create:function(e){var o=e,u=new s({model:o.getLeftArrow()}),a=new s({model:o.getProximalNode()}),f=new s({model:o.getDistalNode()}),l=new s({model:o.getRightArrow()});new i({modelA:u,modelB:a,connectorModel:o}),new i({modelA:a,modelB:f,connectorModel:o}),new i({modelA:f,modelB:l,connectorModel:o});var c=new t({model:u}),h=new t({model:a}),p=new t({model:f}),d=new t({model:l}),v=new r({leftArrowModel:u,proximalNodeModel:a,distalNodeModel:f,rightArrowModel:l,connectorModel:o});return new n({orientation:"left",model:u,mediator:v,view:c}),new n({orientation:"proximal",model:a,mediator:v,view:h}),new n({orientation:"distal",model:f,mediator:v,view:p}),new n({orientation:"right",model:l,mediator:v,view:d}),v}}}),define("diagram/connectors/nodes/verticalNodesMediator",["BaseType","diagram/connectors/nodes/nodeModel"],function(e,t){return e.extend({initialize:function(e){this.topArrowModel=e.topArrowModel,this.secondTopNodeModel=e.secondTopNodeModel,this.secondBottomNodeModel=e.secondBottomNodeModel,this.bottomArrowModel=e.bottomArrowModel,this.connectorModel=e.connectorModel},addBoxNodeMediator:function(e,t){if(t==="top")this._attachTypeBoxToTopNode(e);else{if(t!=="bottom")throw{name:"IncorrectNodeMediatorAttachmentError"};this._attachTypeBoxToBottomNode(e)}},changeLineStyle:function(){this.connectorModel.alternateLineStyle()},removeBoxNodeMediator:function(e){e==="top"?(this.topArrowModel.setAttached(!1),this.topArrowModel.model.children.attachedBox.set(null),this.topNodeTypeBoxMediator.destroy(),this.topNodeTypeBoxMediator=null):(this.bottomArrowModel.setAttached(!1),this.bottomArrowModel.model.children.attachedBox.set(null),this.bottomNodeTypeBoxMediator.destroy(),this.bottomNodeTypeBoxMediator=null)},destroy:function(){this.detachAll(),this.topArrowModel.destroy(),this.secondTopNodeModel.destroy(),this.secondBottomNodeModel.destroy(),this.bottomArrowModel.destroy()},detachAll:function(){this.topNodeTypeBoxMediator&&this.removeBoxNodeMediator("top"),this.bottomNodeTypeBoxMediator&&this.removeBoxNodeMediator("bottom")},_attachTypeBoxToBottomNode:function(e){this.bottomArrowModel.setAttached(!0);var t=e.typeController.model.model.name;this.bottomArrowModel.model.children.attachedBox.set(t),this.bottomNodeTypeBoxMediator=e},_attachTypeBoxToTopNode:function(e){this.topArrowModel.setAttached(!0);var t=e.typeController.model.model.name;this.topArrowModel.model.children.attachedBox.set(t),this.topNodeTypeBoxMediator=e},update:function(e,t,n,r){switch(e){case"top":this.updateTopArrow(t,n,r);break;case"secondTop":this.updateSecondTopNode(t,n);break;case"secondBottom":this.updateSecondBottomNode(t,n);break;case"bottom":this.updateBottomArrow(t,n,r)}},updateUsingDifference:function(e,t,n){var r,i;switch(e){case"top":r=this.topArrowModel.getXCood()+t,i=this.topArrowModel.getYCood()+n;var s=this.secondTopNodeModel.getYCood();this.topArrowModel.setYCood(this.topNodeTypeBoxMediator.calculateNodeYCood(s)),this._setTopArrowDirection(),this.topArrowModel.setXCood(r),this.secondTopNodeModel.setXCood(r);break;case"bottom":r=this.bottomArrowModel.getXCood()+t,i=this.bottomArrowModel.getYCood()+n;var o=this.secondBottomNodeModel.getYCood();this.bottomArrowModel.setYCood(this.bottomNodeTypeBoxMediator.calculateNodeYCood(o)),this._setBottomArrowDirection(),this.bottomArrowModel.setXCood(r),this.secondBottomNodeModel.setXCood(r)}},fireAttachRequest:function(e){this.connectorModel.fire("attachRequest",this,e)},updateTopArrow:function(e,t,n){if(this._topArrowAttached()){var r=this.topArrowModel.getXCood(),i=this.topArrowModel.getYCood();if(!n){var s=this.topNodeTypeBoxMediator.getTopNodeCoods(e,t,r,i);e=s.x,t=s.y}}this.topArrowModel.setXCood(e),this.topArrowModel.setYCood(t),this.secondTopNodeModel.setXCood(e),this._setTopArrowDirection()},updateSecondTopNode:function(e,t){this._bottomArrowAttached()&&this.bottomArrowModel.setYCood(this.bottomNodeTypeBoxMediator.calculateNodeYCood(t));if(this._topArrowAttached()){var n=this.secondTopNodeModel.getXCood(),r=this.secondTopNodeModel.getYCood(),i=this.topNodeTypeBoxMediator.getSecondTopNodeCoods(e,t,n,r);e=i.x,t=i.y,this.topArrowModel.setYCood(this.topNodeTypeBoxMediator.calculateNodeYCood(t))}this._setBottomArrowDirection(),this._setTopArrowDirection(),this.secondTopNodeModel.setXCood(e),this.secondTopNodeModel.setYCood(t),this.topArrowModel.setXCood(e),this.secondBottomNodeModel.setYCood(t)},updateSecondBottomNode:function(e,t){if(this._bottomArrowAttached()){var n=this.secondBottomNodeModel.getXCood(),r=this.secondBottomNodeModel.getYCood(),i=this.bottomNodeTypeBoxMediator.getSecondBottomNodeCoods(e,t,n,r);e=i.x,t=i.y,this.bottomArrowModel.setYCood(this.bottomNodeTypeBoxMediator.calculateNodeYCood(t))}this._topArrowAttached()&&this.topArrowModel.setYCood(this.topNodeTypeBoxMediator.calculateNodeYCood(t)),this._setTopArrowDirection(),this._setBottomArrowDirection(),this.secondBottomNodeModel.setXCood(e),this.secondBottomNodeModel.setYCood(t),this.secondTopNodeModel.setYCood(t),this.bottomArrowModel.setXCood(e)},updateBottomArrow:function(e,t,n){if(this._bottomArrowAttached()&&!n){var r=this.bottomArrowModel.getXCood(),i=this.bottomArrowModel.getYCood(),s=this.bottomNodeTypeBoxMediator.getBottomNodeCoods(e,t,r,i);e=s.x,t=s.y}this.bottomArrowModel.setXCood(e),this.bottomArrowModel.setYCood(t),this.secondBottomNodeModel.setXCood(e),this._setBottomArrowDirection()},_setBottomArrowDirection:function(){this.bottomArrowModel.getYCood()<this.secondBottomNodeModel.getYCood()?this.bottomArrowModel.setArrowDirection("top"):this.bottomArrowModel.setArrowDirection("bottom"),this.bottomArrowModel.broadcast("change")},_setTopArrowDirection:function(){this.topArrowModel.getYCood()<this.secondTopNodeModel.getYCood()?this.topArrowModel.setArrowDirection("top"):this.topArrowModel.setArrowDirection("bottom"),this.topArrowModel.broadcast("change")},_topArrowAttached:function(){return this.topArrowModel.isAttached()},_bottomArrowAttached:function(){return this.bottomArrowModel.isAttached()}})}),define("diagram/connectors/verticalConnectorFactory",["BaseType","diagram/connectors/nodes/arrowView","diagram/connectors/nodes/arrowController","diagram/connectors/nodes/horizontalNodesMediator","diagram/connectors/lines/lineView","diagram/connectors/nodes/nodeModel","diagram/connectors/nodes/verticalNodesMediator"],function(e,t,n,r,i,s,o){return{create:function(e){var r=e,u=new s({model:r.getTopArrow()}),a=new s({model:r.getSecondTopNode()}),f=new s({model:r.getSecondBottomNode()}),l=new s({model:r.getBottomArrow()});new i({modelA:u,modelB:a,connectorModel:r}),new i({modelA:a,modelB:f,connectorModel:r}),new i({modelA:f,modelB:l,connectorModel:r});var c=new t({model:u}),h=new t({model:a}),p=new t({model:f}),d=new t({model:l}),v=new o({topArrowModel:u,secondTopNodeModel:a,secondBottomNodeModel:f,bottomArrowModel:l,connectorModel:r});return new n({orientation:"top",model:u,mediator:v,view:c}),new n({orientation:"secondTop",model:a,mediator:v,view:h}),new n({orientation:"secondBottom",model:f,mediator:v,view:p}),new n({orientation:"bottom",model:l,mediator:v,view:d}),v}}}),define("diagram/componentFactory",["BaseType","diagram/types/typeView","diagram/types/typeController","diagram/types/typeModel","diagram/connectors/horizontalConnectorModel","diagram/connectors/verticalConnectorModel","diagram/boxHorizontalNodeMediator","diagram/boxVerticalNodeMediator","underscore"],function(e,t,n,r,i,s,o,u,a){return e.extend({initialize:function(e){this.diagramModel=e.diagramModel,this.horizontalConnectorFactory=e.horizontalConnectorFactory,this.verticalConnectorFactory=e.verticalConnectorFactory,this.typeControllerMap={},this.connectorMediators={}},createType:function(e,i){var s=this.diagramModel.createType(e,i),o=new r({diagramModel:this.diagramModel.model,model:s}),u=new t({model:o}),a=new n({model:o,view:u});this.typeControllerMap[i]=a},deleteType:function(e){this.typeControllerMap[e].destroy();var t=this.diagramModel.currentDiagram.name;delete this.diagramModel.model.children.diagrams.children[t].children.types.children[e]},deleteDiagram:function(e){a.each(this.typeControllerMap,function(e,t){this.deleteType(t)},this),a.each(this.connectorMediators,function(e,t){this.deleteConnector(t)},this),this.diagramModel.deleteDiagram(e)},createDiagram:function(e,a){this.diagramModel.createDiagram(e,a);if(a){var f=this.diagramModel.model.children.diagrams.children[e].children.types.children;for(var l in f){var c=new r({diagramModel:this.diagramModel.model,model:f[l]}),h=new t({model:c}),p=new n({model:c,view:h});this.typeControllerMap[c.getName()]=p}var d=this.diagramModel.getConnectors(e);for(var v in d)if(d[v].children.orientation.value==="horizontal"){var m=new i({model:d[v]}),g=this.horizontalConnectorFactory.create(m);this.connectorMediators[m.model.name]=g;var y=d[v].children.nodes.children.left,b=d[v].children.nodes.children.right;if(b.children.attached.value){var w=b.children.attachedBox.value;new o({nodeMediator:g,nodeOrientation:"right",typeController:this.typeControllerMap[w],dontMove:!0})}if(y.children.attached.value){var w=y.children.attachedBox.value;new o({nodeMediator:g,nodeOrientation:"left",typeController:this.typeControllerMap[w],dontMove:!0})}}else{var E=new s({model:d[v]}),g=this.verticalConnectorFactory.create(E);this.connectorMediators[E.model.name]=g;var S=d[v].children.nodes.children.top,x=d[v].children.nodes.children.bottom;if(S.children.attached.value){var w=S.children.attachedBox.value;new u({nodeMediator:g,nodeOrientation:"top",typeController:this.typeControllerMap[w],dontMove:!0})}if(x.children.attached.value){var w=x.children.attachedBox.value;new u({nodeMediator:g,nodeOrientation:"bottom",typeController:this.typeControllerMap[w],dontMove:!0})}}}},createProperty:function(e,t,n){this.diagramModel.createProperty(e,t,n)},createMethod:function(e,t,n){this.diagramModel.createMethod(e,t,n)},createHorizontalConnector:function(e){var t=this.diagramModel.createHorizontalConnector(e),n=this.horizontalConnectorFactory.create(t);this.connectorMediators[t.model.name]=n},createVerticalConnector:function(e){var t=this.diagramModel.createVerticalConnector(e),n=this.verticalConnectorFactory.create(t);this.connectorMediators[t.model.name]=n},deleteConnector:function(e){this.connectorMediators[e].destroy();var t=this.diagramModel.currentDiagram.name;delete this.diagramModel.model.children.diagrams.children[t].children.connectors.children[e]}})}),define("editor/editorView",["BaseType","underscore","jquery"],function(e,t,n){return e.extend({initialize:function(e){this.placeholder=e.el,this.$el=n('<div id="container">'),this.placeholder.append(this.$el),this.model=e.model,this.model.on("change",this.render,this),this.model.on("appendChar",this.appendCharacter,this),this.model.on("reformat",this.reformat,this),this.render()},appendCharacter:function(){this.$el.find(".current-command").html(">"+this.model.get("currentCommand"))},reformat:function(){this.$el.css("height",this.model.get("height")),this.$el.css("width",this.model.get("width"));var e=document.getElementById("container");e.scrollTop=e.scrollHeight},render:function(){this.$el.html(this.template({oldCommands:this.model.get("oldCommands"),currentCommand:">"+this.model.get("currentCommand")})),this.$el.css("height",this.model.get("height"));var e=document.getElementById("container");e.scrollTop=e.scrollHeight},getCurrentCommand:function(){return this.$el.find(".current-command").html().substring(4)},template:t.template(n("#command-line-editor-template").html())})}),define("Model",["BaseType"],function(e){return e.extend({initialize:function(e){this.internalObj={},this._listeners=[];for(var t in e)this.internalObj[t]=e[t]},get:function(e){return this.internalObj[e]},setAttributes:function(e){for(var t in e)this.set(t,e[t])},set:function(e,t){this.internalObj[e]=t},on:function(e,t,n){var r=n?n:this;this._listeners.push({event:e,callback:t,context:r})},fire:function(e,t){for(var n=0;n<this._listeners.length;n++){var r=this._listeners[n];r.event===e&&r.callback.call(r.context,t)}}})}),define("editor/editorModel",["Model","jquery"],function(e,t){return e.extend({minHeight:20,maxHeight:500,minWidth:300,maxWidth:800,initialize:function(t){e.prototype.initialize.call(this,t)},update:function(e,t){this.get("oldCommands").push(e),t&&this.get("oldCommands").push(t),this.set("currentCommand",""),this.fire("change")},setMax:function(){this.set("height",this.maxHeight),this.set("width",this.maxWidth),this.fire("reformat")},clear:function(){this.set("oldCommands",[]),this.set("currentCommand",""),this.fire("change")},setHeight:function(e){this.set("height",e),this.fire("reformat")},setWidth:function(e){this.set("width",e),this.fire("reformat")},setMin:function(){this.set("height",this.minHeight),this.set("width",this.minWidth),this.fire("reformat")},appendChar:function(e){var t=this.get("currentCommand");this.set("currentCommand",t+e),this.fire("appendChar")},backspace:function(){var e=this.get("currentCommand");e=e.substring(0,e.length-1),this.set("currentCommand",e),this.fire("appendChar")},minimize:function(){this.set("height",this.minHeight)},maximize:function(){this.set("height",this.maxHeight)}})}),define("editor/editorController",["BaseType","jquery"],function(e,t){return e.extend({initialize:function(e){this.keymap=e.keymap,this.model=e.model,this.view=e.view,this.commands=e.commandProcessor;var n=this;t(document).keydown(function(e){if(e.keyCode===13)n.enterCommand();else if(e.keyCode===8)n.model.backspace();else{if(n.excludeKey(e.keyCode))return!0;var t=n.getChar(e);n.model.appendChar(t)}return!1})},enterCommand:function(){var e=this.parseCommand(this.view.getCurrentCommand()),n=this;if(!this.handleEditorCommand(e)){var r=e.slice(0),i=e.shift();t.when(this.commands.processCommand(i,e)).then(function(e){n.handleResponse(e,r)})}},formatError:function(e){var t=[];return e.name&&t.push(e.name),e.message&&t.push(e.message),t.join(":")},handleResponse:function(e,t){var n,r;e.error?r=this.formatError(e):e.message&&(r=e.message),n=t.join(" "),this.model.update(n,r)},handleEditorCommand:function(e){var t=e[0],n={};switch(t){case"min":this.model.setMin();break;case"max":this.model.setMax();break;case"clear":console.log("clear console"),e=[],this.model.clear();break;case"height":e[1]?isNaN(parseInt(e[1],10))?(n.error=!0,n.name="InvalidArgumentError",n.message="height command requires numeric value"):this.model.setHeight(e[1]):(n.error=!0,n.name="ArgumentNotSuppliedError",n.message="paramer required");break;case"width":e[1]?isNaN(parseInt(e[1],10))?(n.error=!0,n.name="InvalidArgumentError",n.message="width command requires numeric value"):this.model.setWidth(e[1]):(n.error=!0,n.name="ArgumentNotSuppliedError",n.message="parammeter required");break;default:return!1}return this.handleResponse(n,e),!0},parseCommand:function(e){return e.split(/[\s]+/)},excludeKey:function(e){if(e===116||e==16)return!0},getChar:function(e){var t=e.shiftKey?"s":"_",n=this.keymap[t+e.keyCode];return n!==undefined?n:""}})}),define("editor/commandProcessor",["BaseType","jquery"],function(e,t){return e.extend({initialize:function(){this.commands={}},addCommand:function(e,t){this.commands[t]={context:e,command:e[t]}},addCommands:function(e,t){for(var n=0;n<t.length;n++)this.addCommand(e,t[n])},processCommand:function(e,n){var r=t.Deferred();try{if(!this.commands[e])throw{name:"CommandDoesNotExistException",message:e+" does not exist"};var i=this.commands[e],s=i.command.apply(i.context,n);return s&&s.resolve?s:typeof s=="string"?(r.resolve({message:s}),r):(r.resolve({}),r)}catch(o){var u={};return o.name&&(u.name=o.name),o.message&&(u.message=o.message),r.resolve(u),r}}})}),define("editor/keymap",[],function(){return{_8:"backspace",_9:"tab",_16:"shift",_17:"",_18:"alt",_20:"caps",_32:" ",_33:"pageUp",_34:"pageDown",_35:"end",_36:"home",_37:"left",_38:"up",_39:"right",_40:"down",_45:"insert",_46:"delete",_65:"a",_66:"b",_67:"c",_68:"d",_69:"e",_70:"f",_71:"g",_72:"h",_73:"i",_74:"j",_75:"k",_76:"l",_77:"m",_78:"n",_79:"o",_80:"p",_81:"q",_82:"r",_83:"s",_84:"t",_85:"u",_86:"v",_87:"w",_88:"x",_89:"y",_90:"z",_48:0,_49:1,_50:2,_51:3,_52:4,_53:5,_54:6,_55:7,_56:8,_57:9,_59:";",_163:"#",s163:"~",_173:"-",s173:"_",_188:",",s188:"<",_190:".",s190:">",_191:"/",s191:"?",_192:"`",s192:"",_61:"=",s61:"+",_219:"[",s219:"{",_220:"\\",s220:"|",_221:"]",s221:"}",_222:"'",s222:"@",s48:")",s49:"!",s50:'"',s51:"&pound;",s52:"$",s53:"%",s54:"^",s55:"&",s56:"*",s57:"(",s59:":",s65:"A",s66:"B",s67:"C",s68:"D",s69:"E",s70:"F",s71:"G",s72:"H",s73:"I",s74:"J",s75:"K",s76:"L",s77:"M",s78:"N",s79:"O",s80:"P",s81:"Q",s82:"R",s83:"S",s84:"T",s85:"U",s86:"V",s87:"W",s88:"X",s89:"Y",s90:"Z"}}),define("editor/editor",["BaseType","editor/editorView","editor/editorModel","editor/editorController","editor/commandProcessor","editor/keymap"],function(e,t,n,r,i,s){return e.extend({initialize:function(e){var o=new n;o.setAttributes({oldCommands:["For best results, use 'Chrome' browser. Type 'help' to display help page"],currentCommand:""});var u=new t({el:e.placeholder,model:o}),a=new i;a.addCommands(e.commandObject,e.commands),new r({keymap:s,model:o,view:u,commandProcessor:a})}})}),define("bootstrap",["jquery","diagram/diagramController","diagram/diagramModel2","diagram/types/typeView","diagram/types/typeController","utility/idGenerator","diagram/connectors/horizontalConnectorFactory","diagram/connectors/verticalConnectorFactory","diagram/componentFactory","editor/editor"],function(e,t,n,r,i,s,o,u,a,f){return{start:function(){e(document).ready(function(){var r=new n,i=new a({diagramModel:r,horizontalConnectorFactory:o,verticalConnectorFactory:u}),s=new t({diagramModel:r,componentFactory:i}),l=new f({placeholder:e("#editor-placeholder"),commandObject:s,commands:["help","create","use","con","set","remove","show","load","export"],preferences:{width:300,height:500,backgroundColor:"red",style:"default"}})})}}});